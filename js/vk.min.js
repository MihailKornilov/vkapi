var VK_SCROLL=0,COOKIE_PREFIX=APP_ID+"_"+VIEWER_ID+"_",ZINDEX=0,BC=0,FB,FH,FB_HEIGHT=0,DIALOG_MAXHEIGHT=0,FOTO_HEIGHT=0,REGEXP_NUMERIC=/^\d+$/,REGEXP_CENA=/^[\d]+(.[\d]{1,2})?(,[\d]{1,2})?$/,REGEXP_CENA_MINUS=/^-?[\d]+(.[\d]{1,2})?(,[\d]{1,2})?$/,REGEXP_DATE=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,MONTH_DEF={1:"Январь",2:"Февраль",3:"Март",4:"Апрель",5:"Май",6:"Июнь",7:"Июль",8:"Август",9:"Сентябрь",10:"Октябрь",11:"Ноябрь",12:"Декабрь"},MONTH_DAT={1:"января",2:"февраля",3:"марта",4:"апреля",5:"мая",6:"июня",
7:"июля",8:"августа",9:"сентября",10:"октября",11:"ноября",12:"декабря"},URL=APP_HTML+"/index.php?"+VALUES,AJAX_MAIN=APP_HTML+"/ajax/main.php?"+VALUES+"&ajax=1",hashLoc,hashSet=function(a){if(a||a.p){hashLoc=a.p;var c=!0;switch(a.p){case "client":"info"==a.d&&(hashLoc+="_"+a.id);break;case "zayav":"info"==a.d?hashLoc+="_"+a.id:"add"==a.d?hashLoc+="_add"+(_num(a.id)?"_"+a.id:""):a.d||(c=!1);break;case "zp":"info"==a.d?hashLoc+="_"+a.id:c=!1;break;default:a.d&&(hashLoc+="_"+a.d,a.d1&&(hashLoc+="_"+
a.d1))}c&&VK.callMethod("setLocation",hashLoc)}},_scroll=function(a,c){var b=_cookie("p"),d=_cookie("d");if(!b)return 0;b=COOKIE_PREFIX+"scroll_"+b+(d||"");d=_cookie(b+"_unit");if("set"==a)_cookie(b,VK_SCROLL),c&&_cookie(b+"_unit",c);else if("page"==a)_cookie(b+"_page",c);else if("clear"==a)_cookie(b,0),_cookie(b+"_page",1);else return d&&$("#"+d).css("position","relative").append('<div id="unit-select-show"></div>').find("#unit-select-show").animate({opacity:0.9},200).animate({opacity:0},900,function(){$("#unit-select-show").remove()}),
_num(_cookie(b))},pinEnter=function(){var a={op:"pin_enter",pin:$.trim($("#pin").val())};a.pin&&2<a.pin.length&&($(".vkButton").addClass("busy"),$.post(AJAX_MAIN,a,function(a){a.success?location.href=URL+"&p="+_cookie("p")+"&d="+_cookie("d")+"&id="+_cookie("id"):($(".vkButton").removeClass("busy"),$("#pin").val("").focus(),$(".red").html(a.text))},"json"))},pinConfirm=function(a){function c(){var a={op:"pin_enter",pin:$.trim($("#tpin").val())};a.pin?3>a.pin.length?(b.err("Длина пин-кода от 3 до 10 символов"),
$("#tpin").focus()):(b.process(),$.post(AJAX_MAIN,a,function(a){a.success?b.close():a.max?location.reload():(b.abort(),b.err(a.text),$("#tpin").val("").focus())},"json")):(b.err("Не заполнено поле"),$("#tpin").focus())}if(!a.pin)return!1;var b=_dialog({width:250,head:"Подтверждение пин-кода",content:'<table id="setup-tab"><tr><td colspan="2"><div class="_info">Истекло время действия пин-кода. Требуется подтверждение.</div><tr><td class="label">Пин-код:<td><input id="tpin" type="password" maxlength="10" /></table>',
butSubmit:"Подтвердить",butCancel:"",submit:c});$("#tpin").focus().keyEnter(c);return!0},debugHeight=function(a){var c=$("#_debug").height();FOTO_HEIGHT=a||c<FBH-30?0:c+30;_fbhs()},_cookie=function(a,c){if(void 0!==c){var b=new Date;b.setDate(b.getDate()+1);document.cookie=a+"="+c+"; path=/; expires="+b.toGMTString();return""}for(var b=document.cookie.split("; "),d=0;d<b.length;d++){var e=b[d].split("=");if(e[0]==a)return e[1]}return""},sortable=function(){$("._sort").sortable({axis:"y",update:function(){for(var a=
$(this).find("dd"),c=[],b=0;b<a.length;b++)c.push(a.eq(b).attr("val"));a={op:"sort",table:$(this).attr("val"),ids:c.join()};$.post(AJAX_MAIN,a,function(){},"json")}})},imageSortable=function(){$("._image-spisok").sortable({update:function(){for(var a=$(this).find("a"),c=[],b=0;b<a.length;b++)c.push(a.eq(b).attr("val"));a={op:"image_sort",ids:c.join()};$.post(AJAX_MAIN,a,function(){},"json")}})},_toSpisok=function(a){var c=[];for(k in a)c.push({uid:k,title:a[k]});return c},_toAss=function(a){for(var c=
[],b=0;b<a.length;b++)c[a[b].uid]=a[b].title;return c},_end=function(a,c){2==c.length&&c.push(c[1]);var b=c[2];if(1!=Math.floor(a/10%10))switch(a%10){case 1:b=c[0];break;case 2:b=c[1];break;case 3:b=c[1];break;case 4:b=c[1]}return b},_bool=function(a){return 1==a?1:0},_num=function(a){return REGEXP_NUMERIC.test(a)?1*a:0},_cena=function(a,c){"string"==typeof a&&(a=a.replace(",","."));return 0==a?0:c&&REGEXP_CENA_MINUS.test(a)?1*a:REGEXP_CENA.test(a)?1*a:0},_fbhs=function(){var a;0<FOTO_HEIGHT?(a=FOTO_HEIGHT,
FB.height(a)):(0==DIALOG_MAXHEIGHT&&FB.height("auto"),a=FB.height(),a<DIALOG_MAXHEIGHT&&(a=DIALOG_MAXHEIGHT,FB.height(a)));FB_HEIGHT!=a&&(FB_HEIGHT=a,VK.callMethod("resizeWindow",625,a))},_backfon=function(a){function c(){BC--;ZINDEX-=10;var a=b.find("._backfon");BC?a.css({"z-index":ZINDEX}):a.remove()}void 0===a&&(a=!0);var b=$("body");if(a){ZINDEX+=10;BC||b.find("._backfon").remove().end().append('<div class="_backfon"></div>');var d=b.find("._backfon");d.css({"z-index":ZINDEX});"object"==typeof a&&
d.click(function(){c();a.remove()});BC++}else c()},_msg=function(a,c){a||(a="Выполнено");$("#_msg").remove();$("body").append('<div id="_msg">'+a+"</div>");$("#_msg").css("top",$(this).scrollTop()+200+VK_SCROLL).delay(1200).fadeOut(400,function(){$(this).remove();"function"==typeof c&&c()})},_err=function(a){dialog.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",top:-48,left:126,indent:40,show:1,remove:1})},_wait=function(a){$("#_wait").remove();!1===a?_backfon(!1):($("body").append('<div id="_wait" class="_busy"></div>'),
_backfon($("#_wait")),$("#_wait").css("top",$(this).scrollTop()+200+VK_SCROLL))},_dialog=function(a){function c(){e.remove();_backfon(!1);0==b&&(DIALOG_MAXHEIGHT=0);_fbhs()}$(this).attr("id");a=$.extend({width:360,top:100,padding:10,head:"head: Название заголовка",load:0,content:"content: содержимое центрального поля",submit:function(){},cancel:function(){},butSubmit:"Внести",butCancel:"Отмена"},a);a.load&&(a.content='<div class="load _busy"><div class="ms">В процессе загрузки произошла ошибка.</div></div>');
var b=$(".dFrame").length,d='<div class="_dialog"><div class="head"><div><A class="img_del"></A>'+a.head+'</div></div><div class="dcntr"><iframe class="dFrame" name="dFrame'+b+'"></iframe><div class="content"'+(a.padding?' style="padding:'+a.padding+'px"':"")+">"+a.content+'</div></div><div class="bottom"><div class="vkButton'+(a.butSubmit?"":" dn")+'"><button>'+a.butSubmit+"</button></div>"+(a.butCancel?'<div class="vkCancel"><button>'+a.butCancel+"</button></div>":"")+"</div></div>";0==b&&(DIALOG_MAXHEIGHT=
0);var e=$("body").append(d).find("._dialog:last"),d=e.find(".content"),f=e.find(".bottom"),h=f.find(".vkButton"),g=Math.round(a.width/2);e.find(".head .img_del").click(c);h.find("button").click(function(){a.submit()});f.find(".vkCancel").click(function(){a.cancel();c()});_backfon();e.css({width:a.width+"px",top:$(window).scrollTop()+VK_SCROLL+a.top+"px",left:313-g+"px","z-index":ZINDEX+5});window["dFrame"+b].onresize=function(){for(var a=$(".dFrame"),b=0,c=0;c<a.length;c++){var d=a.eq(c).height();
d>b&&(b=d)}a=b+VK_SCROLL+80;DIALOG_MAXHEIGHT!=a&&(DIALOG_MAXHEIGHT=a,_fbhs())};return{close:c,process:function(){h.addClass("_busy")},abort:function(){h.removeClass("_busy")},bottom:f,content:d,err:function(a){f.vkHint({msg:'<span class="red">'+a+"</span>",top:-48,left:g-85,indent:40,show:1,remove:1})},loadError:function(){e.find(".load").removeClass("_busy")},butSubmit:function(a){h[(a?"remove":"add")+"Class"]("dn");h.find("button").html(a)},submit:function(b){a.submit=b}}},_dialogDel=function(a){a=
$.extend({id:0,head:"записи",op:"_del",func:function(){}},a);var c=_dialog({head:"Удаление "+a.head,padding:50,content:'<center class="red">Подтвердите удаление<br /><b>'+a.head+"</b>.</center>",butSubmit:"Удалить",submit:function(){var b={op:a.op,id:a.id};c.process();$.post(AJAX_MAIN,b,function(b){b.success?(c.close(),_msg("Удалено"),a.func(b)):(c.abort(),c.err(b.text))},"json")}})},_tooltip=function(a,c,b){return' _tooltip"><div class="ttdiv"'+(c?' style="left:'+c+'px"':"")+'><div class="ttmsg">'+
a+'</div><div class="ttug'+(b?" "+b:"")+'"></div></div>'},_parent=function(a,c){for(c=c||"TR";a[0].tagName!=c;)a=a.parent();return a},_busy=function(a){var c=$("#_menu");if(0===a)c.removeClass("_busy");else{if(c.hasClass("_busy"))return!0;c.addClass("_busy")}},_filterSpisok=function(a,c,b){b&&(a[b]=c);a.page=1;_scroll("clear");c=a.op.split("_spisok")[0];for(var d in a)"op"!=d&&"page"!=d&&_cookie(COOKIE_PREFIX+c+"_"+d,escape(a[d]))},_nextCallback=function(){},_yearAss=function(a){var c=(new Date).getFullYear(),
b=c+1,d=[];a=_num(a);2E3<a&&a<c&&(c=a);a>b&&(b=a);for(a=c;a<=b;a++)d[a]=a;return d},_checkAll=function(a,c){for(var b=$("._check"),d=b.length,e=[],f=0;f<d;f++){var h=b.eq(f),g=_num(h.attr("id").split("_check")[0].split("ch")[1]);g&&("change"==a?$("#ch"+g)._check(c):_num(h.find("input").val())&&e.push(g))}return"array"==a?e:e.join()};
$.fn._check=function(a){function c(a){if(!$("#"+d+"_check").hasClass("disabled"))$(document).on("click","#"+d+"_check",function(){a(parseInt(b.val()),d)})}var b=$(this),d=b.attr("id");switch(typeof a){case "number":case "string":case "boolean":a=1==a?1:0;if(b.val()==a)return b;b.val(a);b.parent().removeClass("check"+(1==a?0:1)).addClass("check"+a);return b;case "function":return c(a),b}a=$.extend({name:"",disabled:0,light:0,func:function(){}},a);var e=1==b.val()?1:0;b.val(e);b.wrap('<div class="_check'+
(a.disabled?" disabled":"")+" check"+e+(a.name?"":" e")+(a.light?" l":"")+'" id="'+d+'_check">');b.after(a.name);c(a.func);return b};
$.fn._radio=function(a){function c(a){$(document).on("click","#"+e+"_radio .on,#"+e+"_radio .off",function(){a(parseInt(b.val()),e)})}var b=$(this),d,e=b.attr("id");switch(typeof a){case "number":case "string":d=b.parent();if(d.hasClass("_radio")){d.find(".on").removeClass("on").addClass("off");var f=d.find("div");for(d=0;d<f.length;d++){var h=f.eq(d);if(a==h.attr("val")){h.addClass("on").removeClass("off");break}}b.val(a)}return b;case "function":return c(a),b;case "object":if("length"in a){f=$("#"+
e+"_radio").find("div");for(d=0;d<f.length;d++)h=f.eq(d),h.html("<s></s>"+a[d].title);return b}}a=$.extend({title0:"",spisok:[],light:0,right:15,block:1,func:function(){}},a);var f="",h=b.val(),g=[];a.title0&&(g=[{uid:0,title:a.title0}]);for(d=0;d<a.spisok.length;d++)g.push(a.spisok[d]);for(d=0;d<g.length;d++)var n=g[d],f=f+('<div class="'+(h==n.uid?"on":"off")+(a.light?" l":"")+'" val="'+n.uid+'"'+(a.right?' style="margin-right:'+a.right+'px"':"")+"><s></s>"+n.title+"</div>");b.wrap('<div class="_radio'+
(a.block?" block":"")+'" id="'+e+'_radio">');b.after(f);c(a.func);return b};
$.fn._search=function(a){function c(){h.css("color","#ccc")}var b=$(this),d=b.attr("id");switch(typeof a){case "number":case "string":if("val"==a)return window[d+"_search"].inp();"clear"==a&&window[d+"_search"].clear();return b}a=$.extend({width:126,focus:0,txt:"",func:function(){},enter:0},a);b.html('<div class="_search" style="width:'+a.width+'px"><div class="img_del dn"></div><div class="hold">'+a.txt+'</div><input type="text" style="width:'+(a.width-45)+'px" /></div>');var e=b.find("._search"),
f=b.find("input"),h=b.find(".hold"),g=b.find(".img_del");a.focus&&(f.focus(),c());f.focus(c).blur(function(){h.css("color","#777")}).keyup(function(){var b=0<$(this).val().length;h[(b?"add":"remove")+"Class"]("dn");g[(b?"remove":"add")+"Class"]("dn");a.enter||a.func(f.val(),d)});a.enter&&f.keydown(function(b){13==b.which&&a.func($(this).val(),d)});b.clear=function(){f.val("");g.addClass("dn");h.removeClass("dn")};g.click(function(){b.clear();a.func("",d)});e.click(function(){f.focus();c()});b.inp=
function(a){if(!a)return $.trim(f.val());f.val(a);g.removeClass("dn");h.addClass("dn");return $(this)};b.clear=function(){f.val("");g.addClass("dn");h.removeClass("dn")};return window[d+"_search"]=b};
$.fn._calendar=function(a){function c(){var c,d="<tr>",e=m.getFullYear(),f=m.getMonth()+1,h=m.getDate(),g;g=(new Date(a.year,a.mon-1,1)).getDay();g=0==g?7:g;var n=e==a.year&&f==a.mon,s=0==a.lost,u=a.year==l&&a.mon==p,t;c=a.year;t=a.mon;t--;0==t&&(t=12,c--);t=32-(new Date(c,t,32)).getDate();if(1<g)for(c=0;c<g-1;c++)d+="<td>";for(c=1;c<=t;c++){var v="";a.year<e?v=" lost":a.year==e&&a.mon<f?v=" lost":a.year==e&&a.mon==f&&c<h&&(v=" lost");d+='<td class="'+(!v||v&&!s?" sel":"")+(n&&c==h?" b":"")+(u&&c==
q?" set":"")+v+'"'+(!v||v&&!s?' val="'+c+'"':"")+">"+c;g++;8==g&&c!=t&&(d+="<tr>",g=1)}r.html(d).find(".sel").click(b)}function b(){l=a.year;p=a.mon;q=$(this).attr("val");u.html(q+" "+MONTH_DAT[p]+" "+l);h.val(d());a.func(d())}function d(){return l+"-"+(10>p?"0":"")+p+"-"+(10>q?"0":"")+q}function e(b){b.stopPropagation();a.mon--;0==a.mon&&(a.mon=12,a.year--);t.html(MONTH_DEF[a.mon]+" "+a.year);c()}function f(b){b.stopPropagation();a.mon++;13==a.mon&&(a.mon=1,a.year++);t.html(MONTH_DEF[a.mon]+" "+
a.year);c()}var h=$(this),g=h.attr("id"),n=h.val(),m=new Date;a=$.extend({year:m.getFullYear(),mon:m.getMonth()+1,day:m.getDate(),lost:0,func:function(){},place:"right"},a);REGEXP_DATE.test(n)&&(n=n.split("-"),a.year=n[0],a.mon=Math.abs(n[1]),a.day=Math.abs(n[2]));h.wrap('<div class="_calendar" id="'+g+'_calendar">');h.after('<div class="calinp">'+a.day+" "+MONTH_DAT[a.mon]+" "+a.year+'</div><div class="calabs"></div>');var l=a.year,p=a.mon,q=a.day,u=h.next(),s=u.next(),t,r;h.val(d());u.click(function(b){if(!s.html()){b.stopPropagation();
b=$(".calabs");for(var d=0;d<b.length;d++){var h=b.eq(d);h.parent().attr("id").split("_calendar")[0]!=g&&h.html("")}$(document).on("click.calendar"+g,function(){s.html("");$(document).off("click.calendar"+g)});a.year=l;a.mon=p;a.day=q;s.html('<div class="calcal" style="left:'+("right"==a.place?0:-64)+'px"><table class="calhead"><tr><td class="calback"><td class="calmon">'+MONTH_DEF[p]+" "+l+'<td class="calnext"></table><table class="calweeks"><tr><td>Пн<td>Вт<td>Ср<td>Чт<td>Пт<td>Сб<td>Вс</table><table class="caldays"></table></div>');
s.find(".calback").click(e);s.find(".calnext").click(f);t=s.find(".calmon");r=s.find(".caldays");c()}})};
$.fn.years=function(a){var c=$(this),b=c.attr("id"),d=c.val();if(b){a=$.extend({year:(new Date).getFullYear(),start:function(){},func:function(){},center:function(){}},a);d&&(a.year=1*d);c.after('<div class="years" id="years_'+b+'"><TABLE><TR><TD class="but">&laquo;<TD id="ycenter"><SPAN>'+a.year+'</SPAN><TD class="but">&raquo;</TABLE></div>');c.val(a.year);var e={left:0,speed:2,span:$("#years_"+b+" #ycenter SPAN"),width:Math.round($("#years_"+b+" #ycenter").css("width").split(/px/)[0]/2),ismove:0,
next:function(d){a.start();if(!e.ismove){e.ismove=1;var h=0,g=setInterval(function(){var n=e.span;e.left-=e.speed*d;if(0<e.left&&h&&-1==d||0>e.left&&h&&1==d)e.left=0,e.ismove=0,e.speed=0,clearInterval(g);n[0].style.left=e.left+"px";e.speed+=2;if(e.left>e.width&&!h&&-1==d||e.left<-e.width&&!h&&1==d)h=1,a.year+=d,n.html(a.year),e.left=e.width*d,c.val(a.year),a.func(a.year,b)},25)}}};$("#years_"+b+" #ycenter").click(function(){a.center(a.year,b)});$("#years_"+b+" .but:first").mousedown(function(){allmon=
1;e.next(-1)});$("#years_"+b+" .but:eq(1)").mousedown(function(){allmon=1;e.next(1)})}};$.fn.keyEnter=function(a){$(this).keydown(function(c){13==c.keyCode&&a()});return $(this)};
$.fn.rightLink=function(a){function c(a,b){var c=a.parent();c.find("a").click(function(){c.find(".sel").removeClass("sel");$(this).addClass("sel");var e=$(this).attr("val");a.val(e);b(e,d)})}var b=$(this),d=b.attr("id"),e;if("number"==typeof a||"string"==typeof a){e=b.parent();if(e.hasClass("rightLink")){e.find(".sel").removeClass("sel");var f=e.find("a");for(e=0;e<f.length;e++){var h=f.eq(e);if(a==h.attr("val")){h.addClass("sel");break}}b.val(a)}return b}if("function"==typeof a)return c(b,a),b;a=
$.extend({spisok:[],func:function(){}},a);f="";h=b.val();for(e=0;e<a.spisok.length;e++)var g=a.spisok[e],f=f+("<a "+(h==g.uid?'class="sel"':"")+' val="'+g.uid+'">'+g.title+"</a>");b.wrap('<div class="rightLink">');b.after(f);c(b,a.func);return b};
$.fn._dropdown=function(a){function c(c){b();a.nosel||(d.val(c),u.html(g[c])[(a.title0&&!c?"add":"remove")+"Class"]("grey"),t.html(g[c]))}function b(){p&&(clearTimeout(p),p=0)}var d=$(this),e=d.attr("id");if("number"==typeof a||"string"==typeof a){switch(a){case "remove":d.next().remove("._dropdown");break;default:window[e+"_dropdown"].value(a)}return d}a=$.extend({head:"",headgrey:0,disabled:0,title0:"",spisok:[],func:function(){},nosel:0},a);var f,h=1*d.val()||0,g=function(){for(var b=a.title0?
{0:a.title0}:{},c=0;c<a.spisok.length;c++){var d=a.spisok[c];b[d.uid]=d.title}return b}(),n=a.head||a.title0,m=a.spisok.length,l=a.title0&&!a.disabled?'<a class="ddu grey'+(m?"":" last")+(h?"":" seld")+'" val="0">'+a.title0+"</a>":"",p=0;d.val(h);for(f=0;f<m;f++){var q=a.spisok[f],l=l+('<a class="ddu'+(f==m-1?" last":"")+(h==q.uid?" seld":"")+'" val="'+q.uid+'">'+q.title+"</a>");h==q.uid&&(n=q.title)}d.next().remove("._dropdown");d.after('<div class="_dropdown'+(a.disabled?" disabled":"")+'" id="'+
e+'_dropdown">'+(a.disabled?"<span>"+n+"</span>":'<a class="ddhead'+(h||!a.headgrey&&!a.title0?"":" grey")+'">'+n+"</a>")+'<div class="ddlist"><div class="ddsel">'+n+"</div>"+l+"</div></div>");if(!a.disabled){var h=d.next(),u=h.find(".ddhead"),s=h.find(".ddlist"),t=s.find(".ddsel"),r=s.find(".ddu");u.click(function(){b();s.show()});t.click(function(){b();s.hide()});r.click(function(){var b=$(this),d=parseInt(b.attr("val"));c(d);a.nosel||b.addClass("seld");s.hide();a.func(d,e)}).mouseenter(function(){r.removeClass("seld")});
s.on({mouseleave:function(){p=setTimeout(function(){s.fadeOut(200)},500)},mouseenter:b})}d.value=function(a){c(a);s.find(".seld").removeClass("seld");for(f=0;f<r.length;f++){var b=r.eq(f);if(b.attr("val")==a){b.addClass("seld");break}}};return window[e+"_dropdown"]=d};$.fn._tooltip=function(a,c,b){var d=$(this);d.addClass("_tooltip");d.append('<div class="ttdiv"'+(c?' style="left:'+c+'px"':"")+'><div class="ttmsg">'+a+'</div><div class="ttug'+(b?" "+b:"")+'"></div></div>')};
(function(){var a=function(a,b){this.create(a,b);return a};a.prototype.create=function(a,b){function d(){function a(){p="showing";g.css({top:b.top,left:b.left}).animate({top:m,left:l,opacity:"show"},200,c)}function c(){p="show";if(0!=b.correct)$(document).on("keydown.hint",function(a){a.preventDefault();switch(a.keyCode){case 38:b.top--;m--;break;case 40:b.top++;m++;break;case 37:b.left--;l--;break;case 39:b.left++,l++}g.css({top:m,left:l});g.find("#correct_top").html(b.top);g.find("#correct_left").html(b.left)})}
0!=b.correct&&$(document).off("keydown.hint");switch(p){case "wait_to_hidding":clearTimeout(q);p="show";break;case "hidding":p="showing";g.stop().animate({top:m,left:l,opacity:1},200,c);break;case "hidden":0<b.delayShow?(p="wait_to_showing",q=setTimeout(a,b.delayShow)):a()}}function e(){function d(){p="hidding";g.animate({opacity:"hide"},200,function(){p="hidden";0!=b.remove&&(h.remove(),a.off(b.event+".hint"),a.off("mouseleave.hint"))})}0!=b.correct&&$(document).off("keydown.hint");"wait_to_showing"==
p&&(clearTimeout(q),p="hidden");"showing"==p&&(g.stop(),d());"show"==p&&(0<b.delayHide?(p="wait_to_hidding",q=setTimeout(d,b.delayHide)):d())}b=$.extend({msg:"Сообщение подсказки",width:0,event:"mouseenter",ugol:"bottom",indent:"center",top:0,left:0,show:0,delayShow:0,delayHide:0,correct:0,remove:0},b);var f="<TABLE class=cont_table><TR><TD class=ugttd colspan=3>"+("top"==b.ugol?"<div class=ugt></div>":"")+"<TR><TD class=ugltd>"+("left"==b.ugol?"<div class=ugl></div>":"")+"<TD class=cont>"+(1==b.correct?
"<div class=correct>top: <SPAN id=correct_top>"+b.top+"</SPAN> left: <SPAN id=correct_left>"+b.left+"</SPAN></div>":"")+b.msg+"<TD class=ugrtd>"+("right"==b.ugol?"<div class=ugr></div>":"")+"<TR><TD class=ugbtd colspan=3>"+("bottom"==b.ugol?"<div class=ugb></div>":"")+"</TABLE>",f="<TABLE class=hint_table><TR><TD class=side005><TD>"+("<TABLE><TR><TD class=side012><TD>"+f+"<TD class=side012><TR><TD class=b012 colspan=3></TABLE>")+"<TD class=side005><TR><TD class=b005 colspan=3></TABLE>";a.prev().remove(".hint");
a.before("<div class=hint>"+f+"</div>");var h=a.prev(),g=h.find(".hint_table:first");0<b.width&&g.find(".cont_table:first").width(b.width);var f=g.width(),n=g.height();g.hide().css("visibility","visible");var m=b.top,l=b.left;switch(b.ugol){case "top":m=b.top-15;n=g.find(".ugttd:first");"center"==b.indent?n.css("text-align","center"):"right"==b.indent?n.css("text-align","right"):"left"==b.indent?n.css("text-align","left"):isNaN(b.indent)||(n.css("text-align","left"),10>b.indent&&(b.indent=10),b.indent>
f&&(b.indent=f-28),g.find(".ugt:first").css("margin-left",b.indent+"px"));break;case "right":l=b.left+25;f=g.find(".ugrtd:first");"center"==b.indent?f.css("vertical-align","middle"):"bottom"==b.indent?f.css("vertical-align","bottom"):isNaN(b.indent)||(3>b.indent&&(b.indent=3),b.indent>n&&(b.indent=n-31),g.find(".ugr:first").css("margin-top",b.indent+"px"));break;case "bottom":m=b.top+15;n=g.find(".ugbtd:first");"center"==b.indent?n.css("text-align","center"):"right"==b.indent?n.css("text-align","right"):
"left"==b.indent?n.css("text-align","left"):isNaN(b.indent)||(n.css("text-align","left"),10>b.indent&&(b.indent=10),b.indent>f&&(b.indent=f-28),g.find(".ugb:first").css("margin-left",b.indent+"px"));break;case "left":l=b.left-25,f=g.find(".ugltd:first"),"center"==b.indent?f.css("vertical-align","middle"):"bottom"==b.indent?f.css("vertical-align","bottom"):isNaN(b.indent)||(3>b.indent&&(b.indent=3),b.indent>n&&(b.indent=n-31),g.find(".ugl:first").css("margin-top",b.indent+"px"))}a.off(b.event+".hint");
a.off("mouseleave.hint");a.on(b.event+".hint",d);a.on("mouseleave.hint",e);g.on("mouseenter.hint",d);g.on("mouseleave.hint",e);var p="hidden",q=0;0!=b.show&&d()};$.fn.vkHint=function(c){return new a($(this),c)}})();
$.fn._select=function(a){function c(){if(a.spisok.length){if(a.write){var b=r.val();if(b&&b.length){var c=[];reg=RegExp(b,"i");for(l=0;l<a.spisok.length;l++){for(var b=a.spisok[l],d=b.content.split(E),e=0;e<d.length;e++){var f=d[e];if(f.length&&!E.test(f)&&reg.test(f)){d[e]=f.replace(reg,"<em>$&</em>");b.content=d.join("");c.push(b);break}}if(a.limit&&c.length==a.limit)break}a.spisok=c}}c=a.title0&&!a.write?'<div class="selun title0" val="0">'+a.title0+"</div>":"";b=a.spisok.length;a.limit&&b>a.limit&&
(b=a.limit);for(l=0;l<b;l++)d=a.spisok[l],C[d.uid]||(c+='<div class="selun" val="'+d.uid+'">'+(d.content||d.title)+"</div>");w.removeClass("h250").html(c).find(".selun:last").addClass("last");y=w.height();250<y&&w.addClass("h250")}else w.html('<div class="nofind">'+a.nofind+"</div>").removeClass("h250")}function b(a){if(F[a.keyCode]){a.preventDefault();var b=w.find(".selun"),c=w[0],d=b.length;for(l=0;l<d&&!b.eq(l).hasClass("ov");l++);switch(a.keyCode){case 38:l==d&&(l=1);0<l?(1<d&&b.eq(l).removeClass("ov"),
a=b.eq(l-1)):a=b.eq(0);a.addClass("ov");a=a[0];c.scrollTop>a.offsetTop&&(c.scrollTop=a.offsetTop);0<a.offsetTop-250-c.scrollTop+a.offsetHeight&&(c.scrollTop=a.offsetTop-250+a.offsetHeight);break;case 40:l==d&&(b.eq(0).addClass("ov"),c.scrollTop=0);l<d-1&&(b.eq(l).removeClass("ov"),a=b.eq(l+1),a.addClass("ov"),a=a[0],250<a.offsetTop+a.offsetHeight-c.scrollTop&&(c.scrollTop=a.offsetTop+a.offsetHeight-250),a.offsetTop<c.scrollTop&&(c.scrollTop=a.offsetTop));break;case 13:l<d&&(r.blur(),f(b.eq(l)),n());
break;case 27:case 9:r.blur(),n()}}}function d(){x=a.title0?{0:""}:{};for(l=0;l<a.spisok.length;l++){var b=a.spisok[l];x[b.uid]=b.title;b.content||(b.content=b.title);B.push({uid:b.uid,title:b.title,content:b.content})}}function e(b){if(a.multiselect)if(A){b=D.find(".x");var c=[];for(l=0;l<b.length;l++)c.push(b.eq(l).attr("val"));m.val(c.join())}else m.val(0);else u=b,m.val(b),r.val(x[b]),z[0==b?"show":"hide"]()}function f(b){b=parseInt(b.attr("val"));var c;a.multiselect&&((!a.title0&&!b||0<b)&&r.before('<div class="multi">'+
x[b]+'<span class="x" val="'+b+'"></span></div>'),h(b,!0));e(b);for(l=0;l<a.spisok.length;l++){var d=a.spisok[l];if(d.uid==b){c=d;break}}a.func(b,q,c);v=r.val()}function h(b,d){var e=D.find(".multi"),f=0;A=e.length;for(l=0;l<A;l++){var g=e.eq(l).width();f+g>s+4&&(f=0);f+=g+5+2}f=s-f;r.width(25>f?s:f);void 0!==b&&(C[b]=d,c(),(!a.title0&&0==b||0<b)&&r.val(""));z[A?"hide":"show"]()}function g(){if(!t.hasClass("rs")){t.addClass("rs");var a=w.find(".selun"),c=w[0];a.removeClass("ov");for(l=0;l<a.length;l++){var d=
a.eq(l);if(d.attr("val")==u){d.addClass("ov");d=d[0];a=d.offsetTop+d.offsetHeight;170<a&&(d=250,y>a&&(d-=120<y-a?120:y-a),c.scrollTop=a-d);break}}$(document).on("click."+q+"_select",n).on("keydown."+q+"_select",b)}}function n(){r.is(":focus")||(t.removeClass("rs"),a.write&&!u&&(r.val()&&(r.val(""),a.funcKeyup("")),e(0),a.func(0,q)),$(document).off("click."+q+"_select").off("keydown."+q+"_select"))}var m=$(this),l,p,q=m.attr("id"),u=m.val()||0;switch(typeof a){default:case "number":case "string":p=
window[q+"_select"];switch(a){case "process":p.process();break;case "cancel":p.cancel();break;case "title":return p.title();case "inp":return p.inp();case "remove":$("#"+q+"_select").remove();break;default:REGEXP_NUMERIC.test(a)&&p.value(a)}return m;case "object":if("length"in a)return p=window[q+"_select"],p.spisok(a),m;if(!("spisok"in a))return m}a=$.extend({width:150,disabled:0,block:!1,bottom:0,title0:"",spisok:[],limit:0,write:!1,nofind:"Список пуст",multiselect:0,func:function(){},funcAdd:null,
funcKeyup:function(){a.spisok=[];for(l=0;l<B.length;l++){var b=B[l];a.spisok.push({uid:b.uid,title:b.title,content:b.content})}c()}},a);a.multiselect&&(a.write=!0);var s=a.width-17-5-4;a.funcAdd&&(s-=18);p='<div class="_select'+(a.disabled?" disabled":"")+'" id="'+q+'_select" style="width:'+a.width+"px"+(a.block?";display:block":"")+(a.bottom?";margin-bottom:"+a.bottom+"px":"")+'"><div class="title0bg">'+a.title0+'</div><table class="seltab"><tr><td class="selsel"><input type="text" class="selinp" style="width:'+
s+"px"+(a.write&&!a.disabled?"":";cursor:default")+'"'+(a.write&&!a.disabled?"":" readonly")+" />"+(a.funcAdd?'<td class="seladd">':"")+'<td class="selug"></table><div class="selres" style="width:'+a.width+'px"></div></div>';m.next().remove("._select");m.after(p);var t=m.next(),r=t.find(".selinp"),D=t.find(".selsel"),w=t.find(".selres"),y,z=t.find(".title0bg"),x,B=[],C={},A=0,E=/(<[\/]?[_a-zA-Z0-9=\"' ]*>)/i,F={38:1,40:1,13:1,27:1,9:1};d();if(a.multiselect){if(0!=u)for(p=u.split(","),l=0;l<p.length;l++)C[p[l]]=
!0,r.before('<div class="multi">'+x[p[l]]+'<span class="x" val="'+p[l]+'"></span></div>');h()}a.funcAdd&&!a.disabled&&t.find(".seladd").click(function(){a.funcAdd(q)});c();e(u);var v=r.val();a.disabled||($(document).on("click","#"+q+"_select .selug",g).on("click","#"+q+"_select .selsel",function(){r.focus()}).on("click","#"+q+"_select .selun",function(){f($(this))}).on("mouseenter","#"+q+"_select .selun",function(){w.find(".ov").removeClass("ov");$(this).addClass("ov")}).on("click","#"+q+"_select .x",
function(b){b.stopPropagation();b=$(this).attr("val");$(this).parent().remove();h(b,!1);e(b);a.func(b,q)}),r.focus(function(){g();a.write&&z.css("color","#ccc")}).blur(function(){a.write&&z.css("color","#888")}).keyup(function(b){F[b.keyCode]||(z[r.val()||A?"hide":"show"](),v!=r.val()&&(v=r.val(),a.funcKeyup(v),m.val(0),u=0))}));m.value=e;m.process=function(){r.addClass("_busy")};m.cancel=function(){r.removeClass("_busy")};m.spisok=function(b){a.spisok=b;d();c();m.cancel()};m.title=function(){return x[m.val()]};
m.inp=function(){return r.val()};return window[q+"_select"]=m};
$(document).ajaxStart(_busy).ajaxSuccess(function(a,c,b){function d(a){var b="<table>",c;for(c in a)b+='<tr><td class="val"><b>'+c+"</b>: <td>"+("object"==typeof a[c]?d(a[c]):a[c]);return b+"</table>"}_busy(0);var e=c.responseJSON;if(!pinConfirm(e)&&$("#_debug").length){a="";c='<div class="hd '+(e.success?"res1":"")+(e.error?"res0":"")+'"><b>post</b><a id="repeat">повтор</a>'+(e.success?'<b id="res-success">success</b>':"")+(e.error?'<b id="res-error">error</b>':"")+"</div>";b='<div class="hd"><b>link</b></div><textarea>'+
e.link+"</textarea>";var f='<div class="hd">sql <b>'+e.sql_count+"</b> ("+e.sql_time+") :: php "+e.php_time+"</div>",h;for(h in e)switch(h){case "success":break;case "error":break;case "php_time":break;case "sql_count":break;case "sql_time":break;case "link":break;case "post":for(var g in e.post)c+="<p><b>"+g+"</b>: "+e.post[g];break;case "sql":f+="<ul>"+e[h]+"</ul>";break;default:a+='<div class="hd"><b>'+h+"</b>"+(e[h].length?"<tt>"+e[h].length+"</tt>":"")+"<em>"+typeof e[h]+"</em></div>";if("object"==
typeof e[h]){a+=d(e[h]);break}a+="<textarea>"+e[h]+"</textarea>"}$("#_debug .ajax").html(c+b+f+a);$("#_debug .ajax textarea").autosize();$("#_debug #repeat").click(function(){var a=$(this).parent();a.hasClass("_busy")||(a.addClass("_busy"),$.post(e.link,e.post,function(){},"json"))});window.FBH=FB.height();debugHeight()}}).ajaxError(function(a,c,b){_busy(0);c.responseText&&_dialog({width:600,top:10,head:"Ошибка AJAX-запроса",content:'<textarea style="width:570px;background-color:#fdd">'+c.responseText+
"</textarea>",butSubmit:"",butCancel:"Закрыть"}).content.find("textarea").autosize()}).on("click","#check_all_check",function(){var a=!_num($(this).find("input").val());_checkAll("change",a)}).on("click focus",".vkComment .add textarea,.vkComment .cadd textarea",function(){var a=$(this),c=a.next(),b=a.val();c.is(":hidden")&&(a.val("").attr("val",b).css("color","#000").height(26).autosize(),c.show().css("display","inline-block"))}).on("blur",".vkComment .add TEXTAREA,.vkComment .cadd TEXTAREA",function(){var a=
$(this);if(!a.val())if(a.parent().parent().hasClass("empty"))a.parent().parent().hide().parent().find("span").show();else{var c=a.attr("val");a.val(c).css("color","#777").height(13).next().hide()}}).on("click",".vkComment span a",function(){var a=$(this),c=a.parent().parent().next();a.parent().hide();c.show();c.hasClass("empty")&&c.find("textarea").focus()}).on("click",".vkComment .add .vkButton",function(){var a=$(this);if(!a.hasClass("busy")){var c=a.parent().parent().attr("val").split("_"),c={op:"vkcomment_add",
table:c[0],id:c[1],txt:$.trim(a.prev().val())};c.txt&&(a.addClass("busy"),$.post(AJAX_MAIN,c,function(b){a.removeClass("busy").hide();var c=a.prev().attr("val");a.prev().val(c).css("color","#777").height(13);a.parent().after(b.html)},"json"))}}).on("click",".vkComment .cadd .vkButton",function(){var a=$(this);if(!a.hasClass("busy")){for(var c=a.parent(),b,d,e=0;10>e;e++)if(c=c.parent(),c.hasClass("cunit")&&(b=c.attr("val")),c.hasClass("vkComment")){d=c.attr("val").split("_");break}c={op:"vkcomment_add_child",
table:d[0],id:d[1],txt:$.trim(a.prev().val()),parent:b};c.txt&&(a.addClass("busy"),$.post(AJAX_MAIN,c,function(b){a.removeClass("busy").hide();var c=a.prev().attr("val");a.prev().val(c).css("color","#777").height(13);a.parent().before(b.html).parent().removeClass("empty")},"json"))}}).on("click",".vkComment .unit_del",function(){for(var a=$(this);!a.hasClass("cunit");)a=a.parent();if(!a.hasClass("busy")){var c=a.attr("val"),b={op:"vkcomment_del",id:c};a.addClass("busy");$.post(AJAX_MAIN,b,function(b){a.removeClass("busy");
b.success&&a.find("table:first").hide().before('<div class="deleted">Заметка удалена. <a class="unit_rest" val="'+c+'">Восстановить</a></div>')},"json")}}).on("click",".vkComment .unit_rest,.vkComment .child_rest",function(){var a=$(this);if(!a.hasClass("busy")){var c={op:"vkcomment_rest",id:a.attr("val")};a.addClass("busy");$.post(AJAX_MAIN,c,function(b){a.parent().next().show();a.parent().remove()},"json")}}).on("click",".vkComment .child_del",function(){for(var a=$(this);!a.hasClass("child");)a=
a.parent();if(!a.hasClass("busy")){var c=a.attr("val"),b={op:"vkcomment_del",id:c};a.addClass("busy");$.post(AJAX_MAIN,b,function(b){a.removeClass("busy");b.success&&a.find("table:first").hide().before('<div class="deleted">Комментарий удалён. <a class="child_rest" val="'+c+'">Восстановить</a></div>')},"json")}}).on("click","._check:not(.disabled)",function(){var a=$(this),c=a.find("input"),b=c.val(),d=1==b?0:1;a.removeClass("check"+b);a.addClass("check"+d);c.val(d)}).on("click","._radio .on,._radio .off",
function(){var a=$(this),c=a.parent(),b=a.attr("val");c.find("div.on").removeClass("on").addClass("off");a.removeClass("off").addClass("on");c.find("input:first").val(b)}).on("click","._calendarFilter .week-num,._calendarFilter .on,._calendarFilter .data a",function(){for(var a=$(this),c=a.hasClass("week-num")?a.parent():a,b=c.hasClass("sel"),d=c,a=a.attr("val");!d.hasClass("_calendarFilter");)d=d.parent();b||d.find(".sel").removeClass("sel");c.addClass("sel");d.find(".selected").val(a);window._calendarFilter&&
_calendarFilter(a,"period")}).on("click","._calendarFilter .ch",function(){for(var a=$(this),c={op:"calendar_filter_rewind",month:a.attr("val")};!a.hasClass("_calendarFilter");)a=a.parent();a.hasClass("busy")||(a.addClass("busy"),c.func=a.find(".func").val(),c.sel=a.find(".selected").val(),c.noweek=a.find(".noweek").val(),$.post(AJAX_MAIN,c,function(b){a.removeClass("busy");b.success&&a.find(".content").html(b.html)},"json"))}).on("change","._image-add input",function(){var a,c=$(this).parent(),b=
c.parent();_cookie("_upload","process");a=setInterval(function(){var d=_cookie("_upload");if("process"!=d)switch(clearInterval(a),b.removeClass("busy"),c.find("input[type=file]").remove(),c.append('<input type="file" name="f1" /><input type="file" name="f2" class="f2" /><input type="file" name="f3" class="f3" />'),d=d.split("_"),d[0]){case "uploaded":d=_cookie("_param").split("_");1==d[2]&&$("._image-add").addClass("dn");$("._image-spisok").append('<a class="_iview" val="'+d[1]+'"><div class="del'+
_tooltip("Удалить",-29)+'<em></em></div><img src="'+d[0].replace(/%3A/,":").replace(/%2F/g,"/")+'" /></a>');break;case "error":switch(d[1]){default:case "0":d="Неизвестная ошибка";break;case "1":d="Неверный формат файла";break;case "2":d="Слишком маленькое изображение";break;case "3":d="Превышено количество загружаемых изображений"}$("._image-error").html(d).show().delay(1E3).fadeOut(2E3)}},500);c.submit();b.addClass("busy")}).on("click","._image-spisok .del",function(a){a.stopPropagation();for(var c=
$(this);"A"!=c[0].tagName;)c=c.parent();c.hasClass("deleting")||(c.addClass("deleting"),a={op:"image_del",id:c.attr("val")},$.post(AJAX_MAIN,a,function(a){a.success?(c.remove(),$("._image-add").removeClass("dn")):c.removeClass("deleting")},"json"))}).on("click","._iview",function(a){function c(){var a=n.length,b=m+1>=a?0:m+1,c=n[m];g.find(".head em").html(1<a?"Фотография "+(m+1)+" из "+a:"Просмотр фотографии");g.find(".dtime").html("Добавлена "+c.dtime);g.find(".image img").attr("src",c.link).attr("width",
c.x).attr("height",c.y).on("load",e);g.find(".hide").html('<img src="'+n[b].link+'">')}function b(){g.find(".image").on("click",function(){var a=n.length;1==a?d():(m++,m>=a&&(m=0),c())})}function d(){g.remove();FOTO_HEIGHT=0;_fbhs();VK.callMethod("scrollWindow",h)}function e(){FOTO_HEIGHT=g.height();_fbhs()}a.stopPropagation();$("#_image-view").remove();var f=$(this);a=f.attr("val");var h=VK_SCROLL;"IMG"!=f[0].tagName&&(f=f.find("img"));f='<div id="_image-view"><div class="head"><em class="_busy">&nbsp;</em><a>Закрыть</a></div><table class="image"><tr><td><img src="'+
f.attr("src").replace("-s.","-b.")+'"></table><div class="about"><div class="dtime"></div></div><div class="hide"></div></div>';FB.append(f);var g=$("#_image-view"),n=[],m=1;e();g.find(".head a").click(d);g.find("img:first").on("load",e);$.post(AJAX_MAIN,{op:"image_view",id:a},function(a){g.find("._busy").removeClass("_busy");a.success&&(n=a.img,m=a.n,c(),b())},"json")}).on("click","._next",function(){var a=$(this),c=a.attr("val");c&&(c=c.split(":"),c[1]&&!a.hasClass("_busy")&&(a.addClass("_busy"),
window[c[0]].page=c[1],_scroll("page",_num(c[1])),$.post(AJAX_MAIN,window[c[0]],function(b){b.success?(a.after(b.spisok).remove(),_nextCallback()):a.removeClass("_busy")},"json")))}).ready(function(){FB=$("#frameBody");FH=$("#frameHidden");_fbhs();window.frameHidden.onresize=_fbhs;sortable();imageSortable();VK.callMethod("scrollWindow",_scroll());VK.callMethod("scrollSubscribe");VK.addCallback("onScroll",function(a){VK_SCROLL=a});$("#pin-enter").length&&($("#pin").focus().keydown(function(){$(".red").html("&nbsp;")}).keyEnter(pinEnter),
$(".vkButton").click(pinEnter))});
