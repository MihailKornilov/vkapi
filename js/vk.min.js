var VK_SCROLL=0,COOKIE_PREFIX=APP_ID+"_"+VIEWER_ID+"_",ZINDEX=0,BC=0,FB,FH,FB_HEIGHT=0,DIALOG_MAXHEIGHT=0,FOTO_HEIGHT=0,REGEXP_NUMERIC=/^\d+$/,REGEXP_NUMERIC_MINUS=/^-?\d+$/,REGEXP_CENA=/^[\d]+(.[\d]{1,2})?(,[\d]{1,2})?$/,REGEXP_CENA_MINUS=/^-?[\d]+(.[\d]{1,2})?(,[\d]{1,2})?$/,REGEXP_SIZE=/^[\d]+(.[\d]{1})?(,[\d]{1})?$/,REGEXP_MS=/^[\d]+(.[\d]{1,3})?(,[\d]{1,3})?$/,REGEXP_DATE=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,MONTH_DEF={1:"Январь",2:"Февраль",3:"Март",4:"Апрель",5:"Май",6:"Июнь",7:"Июль",8:"Август",
9:"Сентябрь",10:"Октябрь",11:"Ноябрь",12:"Декабрь"},MONTH_DAT={1:"января",2:"февраля",3:"марта",4:"апреля",5:"мая",6:"июня",7:"июля",8:"августа",9:"сентября",10:"октября",11:"ноября",12:"декабря"},WEEK_NAME={0:"вс",1:"пн",2:"вт",3:"ср",4:"чт",5:"пт",6:"сб",7:"вс"},hashLoc,hashSet=function(a){if(a||a.p){hashLoc=a.p;var c=!0;switch(a.p){case "client":"info"==a.d&&(hashLoc+="_"+a.id);break;case "zayav":"info"==a.d?hashLoc+="_"+a.id:"add"==a.d?hashLoc+="_add"+(_num(a.id)?"_"+a.id:""):a.d||(c=!1);break;
case "zp":"info"==a.d?hashLoc+="_"+a.id:c=!1;break;default:a.d&&(hashLoc+="_"+a.d,a.d1&&(hashLoc+="_"+a.d1))}c&&VK.callMethod("setLocation",hashLoc)}},scannerWord="",scannerTime=0,scannerTimer,scannerDialog,scannerDialogShow=!1,charSpisok={48:"0",49:1,50:2,51:3,52:4,53:5,54:6,55:7,56:8,57:9,65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",189:"-"},_scroll=function(a,
c){var b=_cookie("p"),d=_cookie("d");if(!b)return 0;b=COOKIE_PREFIX+"scroll_"+b+(d||"");d=_cookie(b+"_unit");if("set"==a)_cookie(b,VK_SCROLL),c&&_cookie(b+"_unit",c);else if("page"==a)_cookie(b+"_page",c);else if("clear"==a)_cookie(b,0),_cookie(b+"_page",1);else return d&&$("#"+d).css("position","relative").append('<div id="unit-select-show"></div>').find("#unit-select-show").animate({opacity:0.9},200).animate({opacity:0},900,function(){$("#unit-select-show").remove()}),_num(_cookie(b))},pinLoad=
function(a){$("#pin").focus().keydown(function(){$(".red").html("&nbsp;")}).keyup(function(){7*$(this).val().length==a&&pinEnter()}).keyEnter(pinEnter)},pinEnter=function(){var a={op:"pin_enter",pin:$.trim($("#pin").val())};a.pin&&2<a.pin.length&&($(".vk").addClass("_busy"),$.post(AJAX_MAIN,a,function(a){a.success?location.href=URL+"&p="+_cookie("p")+"&d="+_cookie("d")+"&id="+_cookie("id"):($(".vk").removeClass("_busy"),$("#pin").val("").focus(),$(".red").html(a.text))},"json"))},pinConfirm=function(a){if(!a.pin)return!1;
var c=_dialog({width:250,head:"Подтверждение пин-кода",content:'<table id="setup-tab"><tr><td colspan="2"><div class="_info">Истекло время действия пин-кода. Требуется подтверждение.</div><tr><td class="label">Пин-код:<td><input id="tpin" type="password" maxlength="10" /></table>',butSubmit:"Подтвердить",butCancel:"",submit:function(){var a={op:"pin_enter",pin:$.trim($("#tpin").val())};a.pin?3>a.pin.length?(c.err("Длина пин-кода от 3 до 10 символов"),$("#tpin").focus()):(c.process(),$.post(AJAX_MAIN,
a,function(a){a.success?c.close():a.max?location.reload():(c.abort(),c.err(a.text),$("#tpin").val("").focus())},"json")):(c.err("Не заполнено поле"),$("#tpin").focus())}});$("#tpin").focus();return!0},debugHeight=function(a){var c=$("#_debug").height();FOTO_HEIGHT=a||c<FBH-30?0:c+30;_fbhs()},_cookie=function(a,c){if(void 0!==c){var b=new Date;b.setDate(b.getDate()+1);document.cookie=a+"="+c+"; path=/; expires="+b.toGMTString();return""}for(var b=document.cookie.split("; "),d=0;d<b.length;d++){var e=
b[d].split("=");if(e[0]==a)return e[1]}return""},sortable=function(){$("._sort").sortable({axis:"y",update:function(){if($(this).hasClass("no"))return!0;for(var a=$(this).find("dd"),c=[],b=0;b<a.length;b++){var d=_num(a.eq(b).attr("val"));d&&c.push(d)}a={op:"sort",table:$(this).attr("val"),ids:c.join()};$.post(AJAX_MAIN,a,function(){},"json")}})},_toSpisok=function(a){var c=[];for(k in a)c.push({uid:k,title:a[k]});return c},_toAss=function(a){for(var c=[],b=0;b<a.length;b++)c[a[b].uid]=a[b].title;
return c},_end=function(a,c){2==c.length&&c.push(c[1]);var b=c[2];if(1!=Math.floor(a/10%10))switch(a%10){case 1:b=c[0];break;case 2:b=c[1];break;case 3:b=c[1];break;case 4:b=c[1]}return b},_bool=function(a){return 1==a?1:0},_num=function(a,c){return(c?REGEXP_NUMERIC_MINUS.test(a):REGEXP_NUMERIC.test(a))?1*a:0},_cena=function(a,c){"string"==typeof a&&(a=a.replace(",","."));return 0==a?0:c&&REGEXP_CENA_MINUS.test(a)?1*a:REGEXP_CENA.test(a)?1*a:0},_size=function(a){"string"==typeof a&&(a=a.replace(",",
"."));return 0!=a&&REGEXP_SIZE.test(a)?1*a:0},_ms=function(a){"string"==typeof a&&(a=a.replace(",","."));return 0!=a&&REGEXP_MS.test(a)?1*a:0},_fbhs=function(){var a;0<FOTO_HEIGHT?(a=FOTO_HEIGHT,FB.height(a)):(0==DIALOG_MAXHEIGHT&&FB.height("auto"),a=FB.height(),a<DIALOG_MAXHEIGHT&&(a=DIALOG_MAXHEIGHT,FB.height(a)));FB_HEIGHT!=a&&(FB_HEIGHT=a,VK.callMethod("resizeWindow",625,a))},_backfon=function(a){function c(){BC--;ZINDEX-=10;var a=b.find("._backfon");BC?a.css({"z-index":ZINDEX}):a.remove()}void 0===
a&&(a=!0);var b=$("body");if(a){ZINDEX+=10;BC||b.find("._backfon").remove().end().append('<div class="_backfon"></div>');var d=b.find("._backfon");d.css({"z-index":ZINDEX});"object"==typeof a&&d.click(function(){c();a.remove()});BC++}else c()},_msg=function(a,c){a||(a="Выполнено");$("#_msg").remove();$("body").append('<div id="_msg">'+a+"</div>");$("#_msg").css("top",$(this).scrollTop()+200+VK_SCROLL).delay(1200).fadeOut(400,function(){$(this).remove();"function"==typeof c&&c()})},_err=function(a){dialog.bottom.vkHint({msg:'<SPAN class="red">'+
a+"</SPAN>",top:-48,left:126,indent:40,show:1,remove:1})},_wait=function(a){$("#_wait").remove();!1===a?_backfon(!1):($("body").append('<div id="_wait" class="_busy"></div>'),_backfon($("#_wait")),$("#_wait").css("top",$(this).scrollTop()+200+VK_SCROLL))},_br=function(a){return a.replace(RegExp("<br />","g"),"\n").replace(RegExp("<br>","g"),"\n")},_copySel=function(a,c){for(var b=[],d=0;d<a.length;d++){var e=a[d];e.uid!=c&&b.push(e)}return b},_dialog=function(a){function c(){f.remove();_backfon(!1);
0==d&&(DIALOG_MAXHEIGHT=0);_fbhs()}function b(a){g.vkHint({msg:'<span class="red">'+a+"</span>",top:-48,left:m-90,indent:40,show:1,remove:1})}$(this).attr("id");a=$.extend({width:360,top:100,mb:0,padding:10,head:"head: Название заголовка",load:0,"class":"",content:"content: содержимое центрального поля",submit:function(){},cancel:function(){},butSubmit:"Внести",butCancel:"Отмена"},a);a.load&&(a.content='<div class="load _busy"><div class="ms">В процессе загрузки произошла ошибка.</div></div>');var d=
$(".dFrame").length,e='<div class="_dialog"><div class="head"><a class="img_del"></a>'+a.head+'</div><div class="dcntr"><iframe class="dFrame" name="dFrame'+d+'"></iframe><div class="content'+(a["class"]?" "+a["class"]+"_dialog":"")+'"'+(a.padding?' style="padding:'+a.padding+'px"':"")+">"+a.content+'</div></div><div class="bottom"><button class="vk submit'+(a.butSubmit?"":" dn")+'">'+a.butSubmit+"</button>"+(a.butCancel?'<button class="vk cancel">'+a.butCancel+"</button>":"")+"</div></div>";0==d&&
(DIALOG_MAXHEIGHT=0);var f=$("body").append(e).find("._dialog:last"),e=f.find(".content"),g=f.find(".bottom"),h=g.find(".submit"),m=Math.round(a.width/2);f.find(".head .img_del").click(c);h.click(function(){a.submit()});g.find(".cancel").click(function(b){b.stopPropagation();a.cancel();c()});e.find("input").keyEnter(a.submit);_backfon();f.css({width:a.width+"px",top:$(window).scrollTop()+VK_SCROLL+a.top+"px",left:313-m+"px","z-index":ZINDEX+5});window["dFrame"+d].onresize=function(){for(var b=$(".dFrame"),
c=0,d=0;d<b.length;d++){var e=b.eq(d).height();e>c&&(c=e)}b=c+VK_SCROLL+80+a.mb;DIALOG_MAXHEIGHT!=b&&(DIALOG_MAXHEIGHT=b,_fbhs())};return{close:c,process:function(){h.addClass("_busy")},abort:function(a){h.removeClass("_busy");a&&b(a)},bottom:g,content:e,err:b,loadError:function(){f.find(".load").removeClass("_busy")},butSubmit:function(a){h[(a?"remove":"add")+"Class"]("dn");h.html(a)},submit:function(b){a.submit=b}}},_dialogDel=function(a){a=$.extend({id:0,head:"записи",info:"",op:"_del",func:function(){}},
a);var c=_dialog({head:"Удаление "+a.head,padding:30,content:(a.info?'<div class="_info">'+a.info+"</div>":"")+'<center class="red">Подтвердите удаление<br /><b>'+a.head+"</b>.</center>",butSubmit:"Удалить",submit:function(){var b={op:a.op,id:a.id};c.process();$.post(AJAX_MAIN,b,function(b){b.success?(c.close(),_msg("Удалено"),a.func(b)):c.abort(b.text)},"json")}})},_tooltip=function(a,c,b){return' _tooltip"><div class="ttdiv"'+(c?' style="left:'+c+'px"':"")+'><div class="ttmsg">'+a+'</div><div class="ttug'+
(b?" "+b:"")+'"></div></div>'},_parent=function(a,c){c=c||"TR";var b=10,d=0,e="."==c[0];for(e&&(c=c.substr(1));!d;)a=a.parent(),d=e?a.hasClass(c):a[0].tagName==c,--b||(d=1);return a},_busy=function(a){var c=$("#_menu");if(0===a)c.removeClass("_busy");else{if(c.hasClass("_busy"))return!0;c.addClass("_busy")}},_filterSpisok=function(a,c,b){b&&(a[b]=c);a.page=1;_scroll("clear");c=a.op.split("_spisok")[0];for(var d in a)"op"!=d&&"page"!=d&&"type_id"!=d&&_cookie(COOKIE_PREFIX+c+"_"+d,escape(a[d]))},_nextCallback=
function(){},_yearAss=function(a){var c=(new Date).getFullYear(),b=c+1,d=[];a=_num(a);2E3<a&&a<c&&(c=a);a>b&&(b=a);for(a=c;a<=b;a++)d[a]=a;return d},_checkAll=function(a,c){for(var b=$("._check"),d=b.length,e=[],f=0,g=[],h=0;h<d;h++){var m=b.eq(h),s=_num(m.attr("id").split("_check")[0].split("ch")[1]);s&&("change"==a?$("#ch"+s)._check(c):_num(m.find("input").val())&&(e.push(s),"sum"==a&&(f+=1*_parent(m).find(".sum").html()),g.push(m.parent().attr("val"))))}return"array"==a?e:"count"==a?e.length:"sum"==
a?f:"type"==a?g.join():e.join()};
$.fn._check=function(a){function c(a){if(!$("#"+d+"_check").hasClass("disabled"))$(document).on("click","#"+d+"_check",function(){a(parseInt(b.val()),d)})}var b=$(this),d=b.attr("id");switch(typeof a){case "number":case "string":case "boolean":a=1==a?1:0;if(b.val()==a)return b;b.val(a);b.parent().removeClass("check"+(1==a?0:1)).addClass("check"+a);return b;case "function":return c(a),b}a=$.extend({name:"",disabled:0,light:0,mt:0,block:0,func:function(){}},a);var e=1==b.val()?1:0;b.val(e);b.wrap('<div class="_check'+
(a.disabled?" disabled":"")+" check"+e+(a.name?"":" e")+(a.light?" l":"")+(a.block?" block":"")+'" id="'+d+'_check"'+(a.mt?' style="margin-top:'+a.mt+'px"':"")+">");b.after(a.name);c(a.func);return b};
$.fn._radio=function(a,c){function b(b){var c="";a.title0&&b.unshift({uid:0,title:a.title0});for(f=0;f<b.length;f++)var d=b[f],c=c+('<div class="'+(s==d.uid?"on":"off")+(a.light?" l":"")+'" val="'+d.uid+'"'+(a.right?' style="margin-right:'+a.right+'px"':"")+"><s></s>"+d.title+"</div>");e.after(c)}function d(a){$(document).off("click","#"+g+"_radio .on,#"+g+"_radio .off");$(document).on("click","#"+g+"_radio .on,#"+g+"_radio .off",function(){a(_num(e.val()),g)})}var e=$(this),f,g=e.attr("id"),h=g+
"_radio";switch(typeof a){case "number":case "string":if("spisokUpdate"==a){window[h].spisokUpdate(c);return}h=e.parent();if(h.hasClass("_radio")){h.find(".on").removeClass("on").addClass("off");h=h.find("div");for(f=0;f<h.length;f++){var m=h.eq(f);if(a==m.attr("val")){m.addClass("on").removeClass("off");break}}e.val(a)}return e;case "function":return d(a),e;case "object":if("length"in a){h=$("#"+g+"_radio").find("div");for(f=0;f<h.length;f++)m=h.eq(f),m.html("<s></s>"+a[f].title);return e}}a=$.extend({title0:"",
spisok:[],light:0,right:15,block:1,func:function(){}},a);var s=_num(e.val());e.wrap('<div class="_radio'+(a.block?" block":"")+'" id="'+g+'_radio">');b(_copySel(a.spisok));d(a.func);e.spisokUpdate=function(a){e.parent().find("div").remove();b(a)};return window[h]=e};
$.fn._search=function(a,c){function b(){h.css("color","#ccc")}var d=$(this),e=d.attr("id");switch(typeof a){case "number":case "string":if("val"==a){if(c){window[e+"_search"].inp(c);return}return window[e+"_search"].inp()}"clear"==a&&window[e+"_search"].clear();return d}a=$.extend({width:126,focus:0,txt:"",func:function(){},enter:0,v:""},a);d.html('<div class="_search" style="width:'+a.width+'px"><div class="img_del dn"></div><div class="hold">'+a.txt+'</div><input type="text" style="width:'+(a.width-
45)+'px" /></div>');var f=d.find("._search"),g=d.find("input"),h=d.find(".hold"),m=d.find(".img_del");a.focus&&(g.focus(),b());g.focus(b).blur(function(){h.css("color","#777")}).keyup(function(){var b=0<$(this).val().length;h[(b?"add":"remove")+"Class"]("dn");m[(b?"remove":"add")+"Class"]("dn");a.enter||a.func(g.val(),e)});a.enter&&g.keydown(function(b){13==b.which&&a.func($(this).val(),e)});d.clear=function(){g.val("");m.addClass("dn");h.removeClass("dn")};m.click(function(){d.clear();a.func("",
e)});f.click(function(){g.focus();b()});d.inp=function(a){if(!a)return $.trim(g.val());g.val(a);m.removeClass("dn");h.addClass("dn");return $(this)};d.clear=function(){g.val("");m.addClass("dn");h.removeClass("dn")};window[e+"_search"]=d;d.inp(a.v);return d};
$.fn._calendar=function(a){function c(){var c,d="<tr>",e=s.getFullYear(),f=s.getMonth()+1,g=s.getDate(),h;h=(new Date(a.year,a.mon-1,1)).getDay();h=0==h?7:h;var m=e==a.year&&f==a.mon,p=0==a.lost,r=a.year==n&&a.mon==l,u;c=a.year;u=a.mon;u--;0==u&&(u=12,c--);u=32-(new Date(c,u,32)).getDate();if(1<h)for(c=0;c<h-1;c++)d+="<td>";for(c=1;c<=u;c++){var w="";a.year<e?w=" lost":a.year==e&&a.mon<f?w=" lost":a.year==e&&a.mon==f&&c<g&&(w=" lost");d+='<td class="'+(!w||w&&!p?" sel":"")+(m&&c==g?" b":"")+(r&&c==
q?" set":"")+w+'"'+(!w||w&&!p?' val="'+c+'"':"")+">"+c;h++;8==h&&c!=u&&(d+="<tr>",h=1)}v.html(d).find(".sel").click(b)}function b(){n=a.year;l=a.mon;q=$(this).attr("val");p.html(q+" "+MONTH_DAT[l]+" "+n);g.val(d());a.func(d())}function d(){return n+"-"+(10>l?"0":"")+l+"-"+(10>q?"0":"")+q}function e(b){b.stopPropagation();a.mon--;0==a.mon&&(a.mon=12,a.year--);u.html(MONTH_DEF[a.mon]+" "+a.year);c()}function f(b){b.stopPropagation();a.mon++;13==a.mon&&(a.mon=1,a.year++);u.html(MONTH_DEF[a.mon]+" "+
a.year);c()}var g=$(this),h=g.attr("id"),m=g.val(),s=new Date;a=$.extend({year:s.getFullYear(),mon:s.getMonth()+1,day:s.getDate(),lost:0,func:function(){},place:"right"},a);REGEXP_DATE.test(m)&&"0000-00-00"!=m&&(m=m.split("-"),a.year=m[0],a.mon=Math.abs(m[1]),a.day=Math.abs(m[2]));g.wrap('<div class="_calendar" id="'+h+'_calendar">');g.after('<div class="calinp">'+a.day+" "+MONTH_DAT[a.mon]+" "+a.year+'</div><div class="calabs"></div>');var n=a.year,l=a.mon,q=a.day,p=g.next(),r=p.next(),u,v;g.val(d());
p.click(function(b){if(!r.html()){b.stopPropagation();b=$(".calabs");for(var d=0;d<b.length;d++){var g=b.eq(d);g.parent().attr("id").split("_calendar")[0]!=h&&g.html("")}$(document).on("click.calendar"+h,function(){r.html("");$(document).off("click.calendar"+h)});a.year=n;a.mon=l;a.day=q;r.html('<div class="calcal" style="left:'+("right"==a.place?0:-64)+'px"><table class="calhead"><tr><td class="calback"><td class="calmon">'+MONTH_DEF[l]+" "+n+'<td class="calnext"></table><table class="calweeks"><tr><td>Пн<td>Вт<td>Ср<td>Чт<td>Пт<td>Сб<td>Вс</table><table class="caldays"></table></div>');
r.find(".calback").click(e);r.find(".calnext").click(f);u=r.find(".calmon");v=r.find(".caldays");c()}})};
$.fn._yearLeaf=function(a){var c=$(this),b=c.attr("id"),d=c.val(),e=b+"_yearLeaf",f=(new Date).getFullYear();if(b){if("string"==typeof a)return"cur"==a&&window[e].cur(),c;a=$.extend({year:f,start:function(){},func:function(){},center:function(){}},a);_num(d)?a.year=_num(d):c.val(a.year);c.after('<div class="years" id="years_'+b+'"><TABLE><TR><TD class="but">&laquo;<TD id="ycenter"><span>'+a.year+'</span><TD class="but">&raquo;</TABLE></div>');c.val(a.year);var g={left:0,speed:2,span:$("#years_"+b+
" #ycenter SPAN"),width:Math.round($("#years_"+b+" #ycenter").css("width").split(/px/)[0]/2),ismove:0,next:function(d){a.start();if(!g.ismove){g.ismove=1;var e=0,f=setInterval(function(){var n=g.span;g.left-=g.speed*d;if(0<g.left&&e&&-1==d||0>g.left&&e&&1==d)g.left=0,g.ismove=0,g.speed=0,clearInterval(f);n[0].style.left=g.left+"px";g.speed+=2;if(g.left>g.width&&!e&&-1==d||g.left<-g.width&&!e&&1==d)e=1,a.year+=d,n.html(a.year),g.left=g.width*d,c.val(a.year),a.func(a.year,b)},25)}}};$("#years_"+b+" #ycenter").click(function(){a.center(a.year,
b)});$("#years_"+b+" .but:first").mousedown(function(){allmon=1;g.next(-1)});$("#years_"+b+" .but:eq(1)").mousedown(function(){allmon=1;g.next(1)});c.cur=function(){c.val(f);g.span.html(f)};return window[e]=c}};$.fn.keyEnter=function(a){$(this).keydown(function(c){13==c.keyCode&&a()});return $(this)};
$.fn.rightLink=function(a){function c(a,b){var c=a.parent();c.find("a").click(function(){c.find(".sel").removeClass("sel");$(this).addClass("sel");var e=$(this).attr("val");a.val(e);b(e,d)})}var b=$(this),d=b.attr("id"),e;if("number"==typeof a||"string"==typeof a){e=b.parent();if(e.hasClass("rightLink")){e.find(".sel").removeClass("sel");var f=e.find("a");for(e=0;e<f.length;e++){var g=f.eq(e);if(a==g.attr("val")){g.addClass("sel");break}}b.val(a)}return b}if("function"==typeof a)return c(b,a),b;a=
$.extend({spisok:[],func:function(){}},a);f="";g=b.val();for(e=0;e<a.spisok.length;e++)var h=a.spisok[e],f=f+("<a "+(g==h.uid?'class="sel"':"")+' val="'+h.uid+'">'+h.title+"</a>");b.wrap('<div class="rightLink">');b.after(f);c(b,a.func);return b};
$.fn._dropdown=function(a){function c(c){b();a.nosel||(d.val(c),p.html(h[c])[(a.title0&&!c?"add":"remove")+"Class"]("grey"),u.html(h[c]))}function b(){l&&(clearTimeout(l),l=0)}var d=$(this),e=d.attr("id");if("number"==typeof a||"string"==typeof a){switch(a){case "remove":d.next().remove("._dropdown");break;default:window[e+"_dropdown"].value(a)}return d}a=$.extend({head:"",headgrey:0,disabled:0,title0:"",spisok:[],func:function(){},nosel:0},a);var f,g=1*d.val()||0,h=function(){for(var b=a.title0?
{0:a.title0}:{},c=0;c<a.spisok.length;c++){var d=a.spisok[c];b[d.uid]=d.title}return b}(),m=a.head||a.title0,s=a.spisok.length,n=a.title0&&!a.disabled?'<a class="ddu grey'+(s?"":" last")+(g?"":" seld")+'" val="0">'+a.title0+"</a>":"",l=0;d.val(g);for(f=0;f<s;f++){var q=a.spisok[f],n=n+('<a class="ddu'+(f==s-1?" last":"")+(g==q.uid?" seld":"")+'" val="'+q.uid+'">'+q.title+"</a>");g==q.uid&&(m=q.title)}d.next().remove("._dropdown");d.after('<div class="_dropdown'+(a.disabled?" disabled":"")+'" id="'+
e+'_dropdown">'+(a.disabled?"<span>"+m+"</span>":'<a class="ddhead'+(g||!a.headgrey&&!a.title0?"":" grey")+'">'+m+"</a>")+'<div class="ddlist"><div class="ddsel">'+m+"</div>"+n+"</div></div>");if(!a.disabled){var g=d.next(),p=g.find(".ddhead"),r=g.find(".ddlist"),u=r.find(".ddsel"),v=r.find(".ddu");p.click(function(a){a.stopPropagation();b();r.show()});u.click(function(a){a.stopPropagation();b();r.hide()});v.click(function(b){b.stopPropagation();b=$(this);var d=parseInt(b.attr("val"));c(d);a.nosel||
b.addClass("seld");r.hide();a.func(d,e)}).mouseenter(function(){v.removeClass("seld")});r.on({mouseleave:function(){l=setTimeout(function(){r.fadeOut(200)},500)},mouseenter:b})}d.value=function(a){c(a);r.find(".seld").removeClass("seld");for(f=0;f<v.length;f++){var b=v.eq(f);if(b.attr("val")==a){b.addClass("seld");break}}};return window[e+"_dropdown"]=d};
$.fn._tooltip=function(a,c,b){var d=$(this);d.addClass("_tooltip");d.append('<div class="ttdiv"'+(c?' style="left:'+c+'px"':"")+'><div class="ttmsg">'+a+'</div><div class="ttug'+(b?" "+b:"")+'"></div></div>')};
$.fn._attach=function(a){function c(){if(f){var a=ATTACH[f];e._dropdown({head:a.name,nosel:1,spisok:[{uid:1,title:"Скачать ("+Math.round(a.size/1024)+" кб.)"},{uid:2,title:"Изменить"},{uid:3,title:"Удалить"}],func:function(c){switch(c){case 1:location.href=a.link;break;case 2:b();break;case 3:d()}}})}}function b(){var a=ATTACH[f],a='<div id="attach-add-tab" class="uploaded"><table id="tab"><tr><td class="label r">Название файла:<td><input type="text" id="name" value="'+a.name+'" /><tr><td class="label r">Размер:<td><b id="size">'+
Math.round(a.size/2014)+"</b> Кб</table></div>",b=_dialog({top:40,width:400,head:"Редактирование данных файла",content:a,butSubmit:"Сохранить",submit:function(){var a={op:"attach_edit",id:f,name:$.trim($("#name").val())};a.name?(b.process(),$.post(AJAX_MAIN,a,function(d){b.abort();d.success&&(b.close(),ATTACH[f].name=a.name,c())},"json")):b.err("Не указано название файла")}})}function d(){_dialogDel({id:f,head:"файла",op:"attach_del",func:function(){e.val(0)._dropdown("remove");h.removeClass("ex");
a.func(0)}})}window.ATTACH||(ATTACH={});var e=$(this),f=_num(e.val());a=$.extend({title:"прикрепить файл",icon:0,zayav_id:0,zayav_save:0,func:function(){}},a);e.wrap('<div class="_attach">');var g='<a class="_attach-add">'+a.title+"</a>";a.icon&&(g='<a class="_attach-add img_doc'+_tooltip(a.title,-13,"l")+"</a>");e.parent().append(g);var h=e.parent(),g=h.find("._attach-add");f&&h.addClass("ex");g.click(function(){function b(){var a=_cookie("_attached");0!=a&&(clearInterval(r),l.removeClass("_busy"),
p.css("visibility","visible"),1==a&&(f=_cookie("_attached_id"),$.post(AJAX_MAIN,{op:"attach_get",id:f},function(a){a.success&&($("#name").val(a.name),$("#size").html(a.size),g.addClass("uploaded"),d.butSubmit("Сохранить"))},"json")))}var d=_dialog({top:40,width:400,head:"Загрузка нового файла",content:'<div id="attach-add-tab"><div class="_info"><u>Поддерживаемые типы файлов:</u><br /><br /><b>xls</b> - Microsoft Excel 97-2003<br /><b>xlsx</b> - Excel 2007<br /><b>doc</b> - Microsoft Word 97-2003<br /><b>docx</b> - Microsoft Word 2007<br /><b>rtf</b> - текстовый Word<br /><b>pdf</b> - Adobe Acrobat Reader<br /><b>jpg</b> - изображение в формате JPG<br /><b>png</b> - изображение в формате PNG</div><h1><form method="post" action="'+
AJAX_MAIN+'" enctype="multipart/form-data" target="attach-frame"><input type="hidden" name="op" value="attach_upload" /><input type="file" name="f1" id="file" /></form><button class="vk">Выбрать файл</button></h1><iframe name="attach-frame"></iframe><table id="tab"><tr><td class="label r">Название файла:<td><input type="text" id="name" /><tr><td class="label r">Размер:<td><b id="size">0</b> Кб</table></div>',butSubmit:"",submit:function(){var b={op:"attach_save",id:f,zayav_id:a.zayav_id,zayav_save:a.zayav_save,
name:$.trim($("#name").val())};b.name?(d.process(),$.post(AJAX_MAIN,b,function(b){d.abort();b.success&&(d.close(),h.addClass("ex"),e.val(f),ATTACH[f]=b.arr,c(),a.func(f))},"json")):d.err("Не указано название файла")}}),g=$("#attach-add-tab"),l=g.find(".vk"),q=g.find("form"),p=$("#file"),r;p.change(function(){p.css("visibility","hidden");l.addClass("_busy");_cookie("_attached",0);_cookie("_attached_id",0);r=setInterval(b,500);q.submit()})});c(f)};
(function(){var a=function(a,b){this.create(a,b);return a};a.prototype.create=function(a,b){function d(){function a(){l="showing";h.css({top:b.top,left:b.left}).animate({top:s,left:n,opacity:"show"},200,c)}function c(){l="show";if(0!=b.correct)$(document).on("keydown.hint",function(a){a.preventDefault();switch(a.keyCode){case 38:b.top--;s--;break;case 40:b.top++;s++;break;case 37:b.left--;n--;break;case 39:b.left++,n++}h.css({top:s,left:n});h.find("#correct_top").html(b.top);h.find("#correct_left").html(b.left)})}
0!=b.correct&&$(document).off("keydown.hint");switch(l){case "wait_to_hidding":clearTimeout(q);l="show";break;case "hidding":l="showing";h.stop().animate({top:s,left:n,opacity:1},200,c);break;case "hidden":0<b.delayShow?(l="wait_to_showing",q=setTimeout(a,b.delayShow)):a()}}function e(){function d(){l="hidding";h.animate({opacity:"hide"},200,function(){l="hidden";0!=b.remove&&(g.remove(),a.off(b.event+".hint"),a.off("mouseleave.hint"))})}0!=b.correct&&$(document).off("keydown.hint");"wait_to_showing"==
l&&(clearTimeout(q),l="hidden");"showing"==l&&(h.stop(),d());"show"==l&&(0<b.delayHide?(l="wait_to_hidding",q=setTimeout(d,b.delayHide)):d())}b=$.extend({msg:"Сообщение подсказки",width:0,event:"mouseenter",ugol:"bottom",indent:"center",top:0,left:0,show:0,delayShow:0,delayHide:0,correct:0,remove:0},b);var f="<TABLE class=cont_table><TR><TD class=ugttd colspan=3>"+("top"==b.ugol?"<div class=ugt></div>":"")+"<TR><TD class=ugltd>"+("left"==b.ugol?"<div class=ugl></div>":"")+"<TD class=cont>"+(1==b.correct?
"<div class=correct>top: <SPAN id=correct_top>"+b.top+"</SPAN> left: <SPAN id=correct_left>"+b.left+"</SPAN></div>":"")+b.msg+"<TD class=ugrtd>"+("right"==b.ugol?"<div class=ugr></div>":"")+"<TR><TD class=ugbtd colspan=3>"+("bottom"==b.ugol?"<div class=ugb></div>":"")+"</TABLE>",f="<TABLE class=hint_table><TR><TD class=side005><TD>"+("<TABLE><TR><TD class=side012><TD>"+f+"<TD class=side012><TR><TD class=b012 colspan=3></TABLE>")+"<TD class=side005><TR><TD class=b005 colspan=3></TABLE>";a.prev().remove(".hint");
a.before("<div class=hint>"+f+"</div>");var g=a.prev(),h=g.find(".hint_table:first");0<b.width&&h.find(".cont_table:first").width(b.width);var f=h.width(),m=h.height();h.hide().css("visibility","visible");var s=b.top,n=b.left;switch(b.ugol){case "top":s=b.top-15;m=h.find(".ugttd:first");"center"==b.indent?m.css("text-align","center"):"right"==b.indent?m.css("text-align","right"):"left"==b.indent?m.css("text-align","left"):isNaN(b.indent)||(m.css("text-align","left"),10>b.indent&&(b.indent=10),b.indent>
f&&(b.indent=f-28),h.find(".ugt:first").css("margin-left",b.indent+"px"));break;case "right":n=b.left+25;f=h.find(".ugrtd:first");"center"==b.indent?f.css("vertical-align","middle"):"bottom"==b.indent?f.css("vertical-align","bottom"):isNaN(b.indent)||(3>b.indent&&(b.indent=3),b.indent>m&&(b.indent=m-31),h.find(".ugr:first").css("margin-top",b.indent+"px"));break;case "bottom":s=b.top+15;m=h.find(".ugbtd:first");"center"==b.indent?m.css("text-align","center"):"right"==b.indent?m.css("text-align","right"):
"left"==b.indent?m.css("text-align","left"):isNaN(b.indent)||(m.css("text-align","left"),10>b.indent&&(b.indent=10),b.indent>f&&(b.indent=f-28),h.find(".ugb:first").css("margin-left",b.indent+"px"));break;case "left":n=b.left-25,f=h.find(".ugltd:first"),"center"==b.indent?f.css("vertical-align","middle"):"bottom"==b.indent?f.css("vertical-align","bottom"):isNaN(b.indent)||(3>b.indent&&(b.indent=3),b.indent>m&&(b.indent=m-31),h.find(".ugl:first").css("margin-top",b.indent+"px"))}a.off(b.event+".hint");
a.off("mouseleave.hint");a.on(b.event+".hint",d);a.on("mouseleave.hint",e);h.on("mouseenter.hint",d);h.on("mouseleave.hint",e);var l="hidden",q=0;0!=b.show&&d()};$.fn.vkHint=function(c){return new a($(this),c)}})();
$.fn._select=function(a){function c(){if(a.spisok.length){if(a.write){var b=t.val();if(b&&b.length){var c=[];reg=RegExp(b,"i");for(l=0;l<a.spisok.length;l++){for(var b=a.spisok[l],d=b.content.split(H),e=0;e<d.length;e++){var f=d[e];if(f.length&&!H.test(f)&&reg.test(f)){d[e]=f.replace(reg,"<em>$&</em>");b.content=d.join("");c.push(b);break}}if(a.limit&&c.length==a.limit)break}a.spisok=c}}c=a.title0&&!a.write?'<div class="selun title0" val="0">'+a.title0+"</div>":"";b=a.spisok.length;a.limit&&b>a.limit&&
(b=a.limit);for(l=0;l<b;l++)d=a.spisok[l],F[d.uid]||(c+='<div class="selun" val="'+d.uid+'">'+(d.content||d.title)+"</div>");y.removeClass("h250").html(c).find(".selun:last").addClass("last");B=y.height();250<B&&y.addClass("h250")}else y.html('<div class="nofind">'+a.nofind+"</div>").removeClass("h250")}function b(a){if(I[a.keyCode]){a.preventDefault();var b=y.find(".selun"),c=y[0],d=b.length;for(l=0;l<d&&!b.eq(l).hasClass("ov");l++);switch(a.keyCode){case 38:l==d&&(l=1);0<l?(1<d&&b.eq(l).removeClass("ov"),
a=b.eq(l-1)):a=b.eq(0);a.addClass("ov");a=a[0];c.scrollTop>a.offsetTop&&(c.scrollTop=a.offsetTop);0<a.offsetTop-250-c.scrollTop+a.offsetHeight&&(c.scrollTop=a.offsetTop-250+a.offsetHeight);break;case 40:l==d&&(b.eq(0).addClass("ov"),c.scrollTop=0);l<d-1&&(b.eq(l).removeClass("ov"),a=b.eq(l+1),a.addClass("ov"),a=a[0],250<a.offsetTop+a.offsetHeight-c.scrollTop&&(c.scrollTop=a.offsetTop+a.offsetHeight-250),a.offsetTop<c.scrollTop&&(c.scrollTop=a.offsetTop));break;case 13:l<d&&(t.blur(),g(b.eq(l)),s());
break;case 27:case 9:t.blur(),s()}}}function d(){z=a.title0?{0:""}:{};for(l=0;l<a.spisok.length;l++){var b=a.spisok[l];z[b.uid]=b.title;b.content||(b.content=b.title);E.push({uid:b.uid,title:b.title,content:b.content})}}function e(){a.spisok=[];for(l=0;l<E.length;l++){var b=E[l];a.spisok.push({uid:b.uid,title:b.title,content:b.content})}c()}function f(b){if(a.multiselect)if(w){b=G.find(".x");var c=[];for(l=0;l<b.length;l++)c.push(b.eq(l).attr("val"));n.val(c.join())}else n.val(0);else if(r=b,n.val(b),
D[b?"show":"hide"](),b||!b&&!a.write_save)t.val(z[b]?z[b].replace(/&quot;/g,'"'):""),A[0==b?"show":"hide"]()}function g(b){b=parseInt(b.attr("val"));var c;a.multiselect&&((!a.title0&&!b||0<b)&&t.before('<div class="multi">'+z[b]+'<span class="x" val="'+b+'"></span></div>'),h(b,!0));f(b);for(l=0;l<a.spisok.length;l++){var d=a.spisok[l];if(d.uid==b){c=d;break}}a.func(b,p,c);C=t.val()}function h(b,d){var e=G.find(".multi"),f=0;w=e.length;for(l=0;l<w;l++){var g=e.eq(l).width();f+g>v+4&&(f=0);f+=g+5+2}f=
v-f;t.width(25>f?v:f);void 0!==b&&(F[b]=d,c(),(!a.title0&&0==b||0<b)&&t.val(""));A[w?"hide":"show"]()}function m(){if(!x.hasClass("rs")){x.addClass("rs");var a=y.find(".selun"),c=y[0];a.removeClass("ov");for(l=0;l<a.length;l++){var d=a.eq(l);if(d.attr("val")==r){d.addClass("ov");d=d[0];a=d.offsetTop+d.offsetHeight;170<a&&(d=250,B>a&&(d-=120<B-a?120:B-a),c.scrollTop=a-d);break}}$(document).on("click."+p+"_select",s).on("keydown."+p+"_select",b)}}function s(){t.is(":focus")||(x.removeClass("rs"),a.write&&
!r&&(t.val()&&!a.write_save&&(t.val(""),a.funcKeyup("")),f(0),a.func(0,p)),$(document).off("click."+p+"_select").off("keydown."+p+"_select"))}var n=$(this),l,q,p=n.attr("id"),r=n.val()||0;if(p){switch(typeof a){default:case "number":case "string":q=window[p+"_select"];switch(a){case "process":q.process();break;case "cancel":q.cancel();break;case "title":return q.title();case "inp":return q.inp();case "focus":q.focus();break;case "remove":$("#"+p+"_select").remove();window[p+"_select"]=null;break;
default:if(REGEXP_NUMERIC_MINUS.test(a)){var u=q.o.write_save;q.o.write_save=0;q.value(a);q.o.write_save=u}}return n;case "object":if(a.width||a.func)break;if("length"in a)return q=window[p+"_select"],q.spisok(a),n;if(!("spisok"in a))return n}a=$.extend({width:150,disabled:0,block:!1,bottom:0,title0:"",spisok:[],limit:0,write:0,write_save:0,nofind:"Список пуст",multiselect:0,func:function(){},funcAdd:null,funcKeyup:e},a);a.clear=a.write&&!a.multiselect;if(a.multiselect||a.write_save)a.write=!0;var v=
a.width-17-5-4;a.funcAdd&&(v-=18);a.clear&&(v-=18,r=_num(r));q='<div class="_select'+(a.disabled?" disabled":"")+'" id="'+p+'_select" style="width:'+a.width+"px"+(a.block?";display:block":"")+(a.bottom?";margin-bottom:"+a.bottom+"px":"")+'"><div class="title0bg">'+a.title0+'</div><table class="seltab"><tr><td class="selsel"><input type="text" class="selinp" style="width:'+v+"px"+(a.write&&!a.disabled?"":";cursor:default")+'"'+(a.write&&!a.disabled?"":" readonly")+" />"+(a.clear?"<div"+(r?"":' style="display:none"')+
' class="clear'+_tooltip("Очистить",-49,"r")+"</div>":"")+(a.funcAdd?'<td class="seladd">':"")+'<td class="selug"></table><div class="selres" style="width:'+a.width+'px"></div></div>';n.next().remove("._select");n.after(q);var x=n.next(),t=x.find(".selinp"),D=x.find(".clear"),G=x.find(".selsel"),y=x.find(".selres"),B,A=x.find(".title0bg"),z,E=[],F={},w=0,H=/(<[\/]?[_a-zA-Z0-9=\"' ]*>)/i,I={38:1,40:1,13:1,27:1,9:1};d();if(a.multiselect){if(0!=r)for(q=r.split(","),l=0;l<q.length;l++)F[q[l]]=!0,t.before('<div class="multi">'+
z[q[l]]+'<span class="x" val="'+q[l]+'"></span></div>');h()}a.funcAdd&&!a.disabled&&x.find(".seladd").click(function(){a.funcAdd(p)});c();f(r);var C=t.val();a.disabled||($(document).off("click","#"+p+"_select .selug").on("click","#"+p+"_select .selug",m).off("click","#"+p+"_select .selsel").on("click","#"+p+"_select .selsel",function(){t.focus()}).off("click","#"+p+"_select .selun").on("click","#"+p+"_select .selun",function(){g($(this))}).off("mouseenter","#"+p+"_select .selun").on("mouseenter",
"#"+p+"_select .selun",function(){y.find(".ov").removeClass("ov");$(this).addClass("ov")}).off("click","#"+p+"_select .x").on("click","#"+p+"_select .x",function(b){b.stopPropagation();b=$(this).attr("val");$(this).parent().remove();h(b,!1);f(b);a.func(b,p)}),t.focus(function(){m();a.write&&A.css("color","#ccc")}).blur(function(){a.write&&A.css("color","#888")}).keyup(function(b){I[b.keyCode]||(A[t.val()||w?"hide":"show"](),D[t.val()?"show":"hide"](),C!=t.val()&&(C=t.val(),a.funcKeyup(C),n.val(0),
r=0))}),D.click(function(b){b.stopPropagation();f(0);t.val("");A.show();a.func(0,p)}));n.o=a;n.value=f;n.process=function(){t.addClass("_busy")};n.cancel=function(){t.removeClass("_busy")};n.spisok=function(b){a.spisok=b;d();c();n.cancel()};n.title=function(){return z[n.val()]};n.inp=function(){return t.val()};n.focus=function(){t.focus()};return window[p+"_select"]=n}};
$.fn._selectColor=function(a){var c=$(this);c.attr("id");a=$.extend({color_id:0,color_dop:0,func:function(){}},a);c.html('<input type="hidden" id="color_id" value="'+a.color_id+'" /><span class="dn"><tt>-</tt><input type="hidden" id="color_dop" value="'+a.color_dop+'" /></span>').addClass("_select-color");var b=$("#color_id"),d=$("#color_dop"),e=c.find("span");b._select({width:122,title0:"Цвет не указан",spisok:COLOR_SPISOK,func:function(a){e[a?"show":"hide"]();d._select(0);b._select(COLOR_SPISOK)._select(a)}});
e[a.color_id?"show":"hide"]();d._select({width:123,title0:"Цвет не указан",spisok:COLOR_SPISOK,func:function(a){b._select(a?COLORPRE_SPISOK:COLOR_SPISOK)._select(b.val())}})};
$.fn._rubric=function(){function a(a){RUBRIC_SUB_SPISOK[a]&&d._select({width:153,title0:"подрубрика не выбрана",spisok:RUBRIC_SUB_SPISOK[a]})}var c=$(this).attr("id");if(c){var b=$("#"+c),d=$("#"+c+"_sub");b._select({width:100,title0:"не выбрана",spisok:RUBRIC_SPISOK,func:function(b){d.val(0)._select("remove");a(b)}});$("#"+c+"_select").css("margin-right",5);a(b.val())}};
$.fn.insertAtCaret=function(a){return this.each(function(c){if(document.selection)this.focus(),document.selection.createRange().text=a,this.focus();else if(this.selectionStart||"0"==this.selectionStart){c=this.selectionStart;var b=this.selectionEnd,d=this.scrollTop;this.value=this.value.substring(0,c)+a+this.value.substring(b,this.value.length);this.focus();this.selectionStart=c+a.length;this.selectionEnd=c+a.length;this.scrollTop=d}else this.value+=a,this.focus()})};
$(document).ajaxStart(_busy).ajaxSuccess(function(a,c,b){function d(a){var b="<table>",c;for(c in a)b+='<tr><td class="val"><b>'+c+"</b>: <td>"+("object"==typeof a[c]?d(a[c]):a[c]);return b+"</table>"}_busy(0);var e=c.responseJSON;if(!pinConfirm(e)&&$("#_debug").length){a="";c='<div class="hd '+(e.success?"res1":"")+(e.error?"res0":"")+'"><b>post</b><a id="repeat">повтор</a>'+(e.success?'<b id="res-success">success</b>':"")+(e.error?'<b id="res-error">error</b>':"")+"</div>";b='<div class="hd"><b>link</b></div><textarea>'+
e.link+"</textarea>";var f='<div class="hd">sql <b>'+e.sql_count+"</b> ("+e.sql_time+") :: php "+e.php_time+"</div>",g;for(g in e)switch(g){case "success":break;case "error":break;case "php_time":break;case "sql_count":break;case "sql_time":break;case "link":break;case "post":for(var h in e.post)c+="<p><b>"+h+"</b>: "+e.post[h];break;case "sql":f+="<ul>"+e[g]+"</ul>";break;default:a+='<div class="hd"><b>'+g+"</b>"+(e[g].length?"<tt>"+e[g].length+"</tt>":"")+"<em>"+typeof e[g]+"</em></div>";if("object"==
typeof e[g]){a+=d(e[g]);break}a+="<textarea>"+e[g]+"</textarea>"}$("#_debug .ajax").html(c+b+f+a);$("#_debug .ajax textarea").autosize();$("#_debug #repeat").click(function(){var a=$(this).parent();a.hasClass("_busy")||(a.addClass("_busy"),$.post(e.link,e.post,function(){},"json"))});window.FBH=FB.height();debugHeight()}}).ajaxError(function(a,c,b){_busy(0);c.responseText&&_dialog({width:600,top:10,head:"Ошибка AJAX-запроса",content:'<textarea style="width:570px;background-color:#fdd">'+c.responseText+
"</textarea>",butSubmit:"",butCancel:"Закрыть"}).content.find("textarea").autosize()}).keydown(function(a){function c(){scannerWord="";scannerTime=0;scannerTimer&&clearTimeout(scannerTimer);scannerTimer=void 0;scannerDialogShow=!1}if(!scannerDialogShow)if(13==a.keyCode){var b=(new Date).getTime()-scannerTime;if(5<scannerWord.length&&300>b){scannerDialogShow=!0;scannerTimer=setTimeout(c,500);scannerDialog=_dialog({head:"Сканер штрих-кода",width:250,content:"Получен код: <b>"+scannerWord+"</b>",butSubmit:"Поиск"});
var d={op:"scanner_word",word:scannerWord};scannerDialog.process();$.post(AJAX_MAIN,d,function(b){if(b.success)if("input"==a.target.localName)scannerDialog.close();else if("zayav"==_cookie("p")&&"add"==_cookie("d"))$("#"+(b.imei?"imei":"serial")).val(d.word),scannerDialog.close();else if(b.zayav_id)document.location.href=URL+"&p=zayav&d=info&id="+b.zayav_id;else{var c="client"==_cookie("p")&&"info"==_cookie("d")?_cookie("id"):0;document.location.href=URL+"&p=zayav&d=add&"+(b.imei?"imei":"serial")+
"="+d.word+(c?"&back=client&id="+c:"")}else scannerDialog.abort()},"json")}}else scannerDialog&&(scannerDialog.close(),scannerDialog=void 0),scannerTimer&&clearTimeout(scannerTimer),scannerTimer=setTimeout(c,500),scannerWord||(scannerTime=(new Date).getTime()),scannerWord+=charSpisok[a.keyCode]||""}).on("click","#check_all_check",function(){var a=!_num($(this).find("input").val());_checkAll("change",a)}).on("click","#_info-top .img_del",function(){$(this).parent().slideUp();var a={op:"manual_answer",
manual_id:$(this).attr("val"),val:2};$.post(AJAX_MAIN,a,function(){},"json")}).on("click focus","._note-area",function(a){a.stopPropagation();var c=$(this),b=c.parent().parent();if(!b.hasClass("active")){b.addClass("active");var d=c.attr("placeholder"),e=b.attr("id");c.attr("placeholder","").height(28).autosize().keydown(function(a){a.ctrlKey&&13==a.keyCode&&b.find(".vk").trigger("click")});$(document).on("click."+e,function(a){c.val()||b.find("._note-img").html()||($(document).off("click."+e),c.attr("placeholder",
d).height(14),b.removeClass("active"))})}}).on("click","._note-area-add .area-image",function(a){a.stopPropagation();var c=$(this),b=c.parent().next();a=c.attr("val");var d={op:"image_obj_get",key:a};_imageAdd({key:a,func:function(){b.addClass("_busy").html("&nbsp;");$.post(AJAX_MAIN,d,function(a){b.removeClass("_busy").html(a.success?a.img:"");c.next().focus()},"json")}})}).on("click","._note-area-add .vk",function(a){a.stopPropagation();var c=$(this),b=c.parent(),d=b.find("._note-area"),e=_num(b.attr("val"));
d.focus();c.hasClass("_busy")||(a=_parent(c,"._note").attr("val").split("#"),a={op:e?"note_comment_add":"note_add",page_name:a[0],page_id:a[1],note_id:e,txt:$.trim(d.val()),key:d.prev().attr("val")},c.addClass("_busy"),$.post(AJAX_MAIN,a,function(a){c.removeClass("_busy");a.success&&(b.find("._note-img").html(""),d.val("").focus(),b[e?"before":"after"](a.html),$(".nu.deleted,.cu.deleted").remove(),e||b.parent().find("tt").html(a.count))},"json"))}).on("click",".nu-go-comm",function(){var a=$(this),
c=_parent(a,"TD");c.find("h2").removeClass("dn").next().removeClass("dn");c.find("textarea").focus().autosize();a.remove()}).on("click","._note .nu-del",function(){var a=$(this),c=_parent(a,".nu-tab").parent();c.hasClass("busy")||(a={op:"note_del",note_id:c.attr("val")},c.addClass("busy"),$.post(AJAX_MAIN,a,function(a){c.removeClass("busy");a.success&&c.addClass("deleted")},"json"))}).on("click","._note .nu-rest a",function(){var a=$(this),c=a.parent().parent();if(!a.hasClass("_busy")){var b={op:"note_rest",
note_id:c.attr("val")};a.addClass("_busy");$.post(AJAX_MAIN,b,function(b){a.removeClass("_busy");b.success&&c.removeClass("deleted")},"json")}}).on("click","._note .cu-del",function(){var a=$(this),c=_parent(a,".cu-tab").parent();c.hasClass("busy")||(a={op:"note_comment_del",id:c.attr("val")},c.addClass("busy"),$.post(AJAX_MAIN,a,function(a){c.removeClass("busy");a.success&&c.addClass("deleted")},"json"))}).on("click","._note .cu-rest a",function(){var a=$(this),c=a.parent().parent();if(!a.hasClass("_busy")){var b=
{op:"note_comment_rest",id:c.attr("val")};a.addClass("_busy");$.post(AJAX_MAIN,b,function(b){a.removeClass("_busy");b.success&&c.removeClass("deleted")},"json")}}).on("click",".dlink.js .link",function(){var a=$(this);a.parent().find(".sel").removeClass("sel");var a=a.addClass("sel").index(),c=$(".dlink-page");c.addClass("dn");c.eq(a).removeClass("dn")}).on("click","._check:not(.disabled)",function(){var a=$(this),c=a.find("input"),b=c.val(),d=1==b?0:1;a.removeClass("check"+b);a.addClass("check"+
d);c.val(d)}).on("click","._radio .on,._radio .off",function(){var a=$(this),c=_parent(a,"._radio"),b=a.attr("val");c.find("div.on").removeClass("on").addClass("off");a.removeClass("off").addClass("on");c.find("input:first").val(b)}).on("click","._calendarFilter .week-num,._calendarFilter .on,._calendarFilter .data a",function(){for(var a=$(this),c=a.hasClass("week-num")?a.parent():a,b=c.hasClass("sel"),d=c,a=a.attr("val");!d.hasClass("_calendarFilter");)d=d.parent();b||d.find(".sel").removeClass("sel");
c.addClass("sel");d.find(".selected").val(a);window._calendarFilter&&_calendarFilter(a,"period")}).on("click","._calendarFilter .ch",function(){for(var a=$(this),c={op:"calendar_filter_rewind",month:a.attr("val")};!a.hasClass("_calendarFilter");)a=a.parent();a.hasClass("busy")||(a.addClass("busy"),c.func=a.find(".func").val(),c.sel=a.find(".selected").val(),c.noweek=a.find(".noweek").val(),$.post(AJAX_MAIN,c,function(b){a.removeClass("busy");b.success&&a.find(".content").html(b.html)},"json"))}).on("click",
"._next",function(){var a=$(this),c=a.attr("val");c&&(c=c.split(":"),c[1]&&!a.hasClass("_busy")&&(a.addClass("_busy"),window[c[0]].page=c[1],_scroll("page",_num(c[1])),$.post(AJAX_MAIN,window[c[0]],function(b){b.success?(a.after(b.spisok).remove(),_nextCallback()):a.removeClass("_busy")},"json")))}).ready(function(){FB=$("#frameBody");FH=$("#frameHidden");_fbhs();window.frameHidden.onresize=_fbhs;sortable();VK.callMethod("scrollWindow",_scroll());VK.callMethod("scrollSubscribe");VK.addCallback("onScroll",
function(a){VK_SCROLL=a})});
