var remindFilter=function(b,a){return{op:"remind_spisok",status:"_remind-status"==a?$("#_remind-status").val():$("#remind_filter_status").val()}},remindSpisok=function(b,a){$("#mainLinks").addClass("busy");$.post(AJAX_MAIN,remindFilter(b,a),function(a){$("#mainLinks").removeClass("busy");a.success&&$(".left").html(a.html)},"json")};
$(document).on("click","._remind-add",function(){var b=_dialog({top:40,width:420,head:"Внесение нового напоминания",content:'<table class="_remind-add-tab">'+(window.ZAYAV?'<tr><td class="label">Заявка:<td>'+ZAYAV.head:"")+(window.CLIENT?'<tr><td class="label">Клиент:<td>'+CLIENT.fio:"")+'<tr><td class="label top">Описание:<td><textarea id="txt"></textarea><tr><td class="label">День выполнения:<td><input type="hidden" id="day" /></table><input type="hidden" id="client_id" value="'+(window.CLIENT?
CLIENT.id:0)+'"><input type="hidden" id="zayav_id" value="'+(window.ZAYAV?ZAYAV.id:0)+'">',submit:function(){var a={op:"remind_add",from:window.ZAYAV?"zayav":window.CLIENT?"client":"",client_id:$("#client_id").val(),zayav_id:$("#zayav_id").val(),txt:$.trim($("#txt").val()),day:$("#day").val()};a.txt?(b.process(),$.post(AJAX_MAIN,a,function(c){c.success?(b.close(),_msg("Напоминание внесено"),$(a.from?"#remind-spisok":"td.left").html(c.html)):b.abort()},"json")):(b.err("Не указано описание"),$("#txt").focus())}});
$("#txt").autosize().focus();$("#day")._calendar();return!1}).on("click","._remind-unit .action",function(){function b(a){var b={op:"remind_action",from:window.ZAYAV?"zayav":window.CLIENT?"client":"",id:c,status:a,day:$("#remind_day").val(),reason:$("#reason")._select("inp")};1==a&&b.day==f?e.err("Выберите другой день"):1!=a||b.reason?$.post(AJAX_MAIN,b,function(a){a.success&&(e.close(),_msg("Данные изменены!"),$(b.from?"#remind-spisok":"td.left").html(a.html))},"json"):e.err("Не указана причина")}
for(var a=$(this);!a.hasClass("_remind-unit");)a=a.parent();var c=a.attr("val"),d=a.find(".hdtxt").html(),f=a.find(".ruday").val(),e=_dialog({top:30,head:"Изменение статуса напоминания",content:'<div id="_remind-action-tab"><div id="hd">'+d+'</div><div class="st c1" val="1">Указать другой день<div class="about">Перенести напоминание на другой день.</div></div><div class="st c2" val="2">Выполнено<div class="about">Задание выполнено успешно.</div></div><div class="st c0" val="0">Отмена<div class="about">Отмена напоминания по какой-либо причине.</div></div><table id="ra-tab"><tr><td class="label">Новый день:<td><input type="hidden" id="remind_day" value="'+
f+'" /><tr><td class="label">Причина:<td><input type="hidden" id="reason" /></table></div>',butSubmit:"",butCancel:"Закрыть",submit:function(){b(1)}});$("#remind_day")._calendar();$("#reason")._select({width:225,spisok:[],write:!0});$("#reason")._select("process");$.post(AJAX_MAIN,{op:"remind_reason_spisok"},function(a){$("#reason")._select("cancel");a.success&&$("#reason")._select(a.spisok)},"json");$(".st").click(function(){var a=$(this).attr("val");1==a?($(".c2,.c0").hide(),$("#ra-tab").show(),
e.butSubmit("Применить")):($("#_remind-action-tab").addClass("busy"),b(a))})}).on("click","._remind-unit .img_edit",function(){function b(a){var b={op:"remind_head_edit",from:window.ZAYAV?"zayav":window.CLIENT?"client":"",id:c,txt:$("#hdtxt").val()};b.txt?(d.process(),$.post(AJAX_MAIN,b,function(a){a.success?(d.close(),_msg("Данные изменены!"),$(b.from?"#remind-spisok":"td.left").html(a.html)):d.abort()},"json")):d.err("Не указан текст")}for(var a=$(this);!a.hasClass("_remind-unit");)a=a.parent();
var c=a.attr("val"),a='<table id="_remind-head-edit"><tr><td class="label">Текст:<td><input type="text" id="hdtxt" value="'+a.find(".hdtxt").html()+'" /></table>',d=_dialog({width:460,head:"Редактирование содержания напоминания",content:a,butSubmit:"Применить",submit:b});$("#hdtxt").keyEnter(b)}).on("click","._remind-unit .ruhist",function(){$(this).parent().next().slideToggle(300)}).on("click","#_remind-next",function(){var b=$(this),a=remindFilter();a.page=$(this).attr("val");b.hasClass("busy")||
(b.addClass("busy"),$.post(AJAX_MAIN,a,function(a){a.success?b.after(a.html).remove():b.removeClass("busy")},"json"))}).ready(function(){$("#_remind-status").length&&$("#_remind-status")._radio(remindSpisok)});
